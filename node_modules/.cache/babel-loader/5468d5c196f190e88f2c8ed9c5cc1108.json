{"remainingRequest":"C:\\Users\\SDC-8\\Desktop\\Sowndarya\\CMTI- Running Projects\\PiWeb Running\\PiWeb-CMTI-Pdf trying\\1stApril\\Trying\\PiWeb-CMTI (2)\\PiWeb-CMTI\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\SDC-8\\Desktop\\Sowndarya\\CMTI- Running Projects\\PiWeb Running\\PiWeb-CMTI-Pdf trying\\1stApril\\Trying\\PiWeb-CMTI (2)\\PiWeb-CMTI\\node_modules\\dxf-viewer\\src\\TextRenderer.js","dependencies":[{"path":"C:\\Users\\SDC-8\\Desktop\\Sowndarya\\CMTI- Running Projects\\PiWeb Running\\PiWeb-CMTI-Pdf trying\\1stApril\\Trying\\PiWeb-CMTI (2)\\PiWeb-CMTI\\node_modules\\dxf-viewer\\src\\TextRenderer.js","mtime":1704432456000},{"path":"C:\\Users\\SDC-8\\Desktop\\Sowndarya\\CMTI- Running Projects\\PiWeb Running\\PiWeb-CMTI-Pdf trying\\1stApril\\Trying\\PiWeb-CMTI (2)\\PiWeb-CMTI\\babel.config.js","mtime":1694764762000},{"path":"C:\\Users\\SDC-8\\Desktop\\Sowndarya\\CMTI- Running Projects\\PiWeb Running\\PiWeb-CMTI-Pdf trying\\1stApril\\Trying\\PiWeb-CMTI (2)\\PiWeb-CMTI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1704432454000},{"path":"C:\\Users\\SDC-8\\Desktop\\Sowndarya\\CMTI- Running Projects\\PiWeb Running\\PiWeb-CMTI-Pdf trying\\1stApril\\Trying\\PiWeb-CMTI (2)\\PiWeb-CMTI\\node_modules\\babel-loader\\lib\\index.js","mtime":1704432454000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgRW50aXR5IH0gZnJvbSAiLi9EeGZTY2VuZSI7CmltcG9ydCB7IFNoYXBlUGF0aCB9IGZyb20gInRocmVlL3NyYy9leHRyYXMvY29yZS9TaGFwZVBhdGguanMiOwppbXBvcnQgeyBTaGFwZVV0aWxzIH0gZnJvbSAidGhyZWUvc3JjL2V4dHJhcy9TaGFwZVV0aWxzLmpzIjsKaW1wb3J0IHsgTWF0cml4MywgVmVjdG9yMiB9IGZyb20gInRocmVlIjsKaW1wb3J0IHsgTVRleHRGb3JtYXRQYXJzZXIgfSBmcm9tICIuL01UZXh0Rm9ybWF0UGFyc2VyIjsKCi8qKiBSZWdleCBmb3IgcGFyc2luZyBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gdGV4dCBlbnRpdGllcy4gKi8KY29uc3QgU1BFQ0lBTF9DSEFSU19SRSA9IC8oPzolJShbZHBjb3UlXSkpfCg/OlxcVVwrKFswLTlhLWZBLUZdezR9KSkvZzsKCi8qKgogKiBQYXJzZSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gdGV4dCBlbnRpdGllcyBhbmQgY29udmVydCB0aGVtIHRvIGNvcnJlc3BvbmRpbmcgdW5pY29kZQogKiBjaGFyYWN0ZXJzLgogKiBodHRwczovL2tub3dsZWRnZS5hdXRvZGVzay5jb20vc3VwcG9ydC9hdXRvY2FkL2xlYXJuLWV4cGxvcmUvY2Fhcy9DbG91ZEhlbHAvY2xvdWRoZWxwLzIwMTkvRU5VL0F1dG9DQUQtQ29yZS9maWxlcy9HVUlELTUxOEUxQTlELTM5OEMtNEE4QS1BQzMyLTJEODU1OTBDREJFMS1odG0uaHRtbAogKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBSYXcgc3RyaW5nLgogKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyB3aXRoIHNwZWNpYWwgY2hhcmFjdGVycyByZXBsYWNlZC4KICovCmV4cG9ydCBmdW5jdGlvbiBQYXJzZVNwZWNpYWxDaGFycyh0ZXh0KSB7CiAgcmV0dXJuIHRleHQucmVwbGFjZUFsbChTUEVDSUFMX0NIQVJTX1JFLCAobWF0Y2gsIHAxLCBwMikgPT4gewogICAgaWYgKHAxICE9PSB1bmRlZmluZWQpIHsKICAgICAgc3dpdGNoIChwMSkgewogICAgICAgIGNhc2UgImQiOgogICAgICAgICAgcmV0dXJuICJceGIwIjsKICAgICAgICBjYXNlICJwIjoKICAgICAgICAgIHJldHVybiAiXHhiMSI7CiAgICAgICAgY2FzZSAiYyI6CiAgICAgICAgICByZXR1cm4gIlx1MjIwNSI7CiAgICAgICAgY2FzZSAibyI6CiAgICAgICAgICAvKiBUb2dnbGVzIG92ZXJzY29yZSBtb2RlIG9uIGFuZCBvZmYsIG5vdCBpbXBsZW1lbnRlZC4gKi8KICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICBjYXNlICJ1IjoKICAgICAgICAgIC8qIFRvZ2dsZXMgdW5kZXJzY29yZSBtb2RlIG9uIGFuZCBvZmYsIG5vdCBpbXBsZW1lbnRlZC4gKi8KICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICBjYXNlICIlIjoKICAgICAgICAgIHJldHVybiAiJSI7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAocDIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBjb2RlID0gcGFyc2VJbnQocDIsIDE2KTsKICAgICAgaWYgKGlzTmFOKGNvZGUpKSB7CiAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICB9CiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpOwogICAgfQogICAgcmV0dXJuIG1hdGNoOwogIH0pOwp9CgovKioKICogSGVscGVyIGNsYXNzIGZvciByZW5kZXJpbmcgdGV4dC4KICogQ3VycmVudGx5IGl0IGlzIGp1c3QgYmFzaWMgdmVyeSBzaW1wbGlmaWVkIGltcGxlbWVudGF0aW9uIGZvciBNVlAuIEZ1cnRoZXIgd29yayBzaG91bGQgaW5jbHVkZToKICogICogU3VwcG9ydCBEWEYgdGV4dCBzdHlsZXMgYW5kIHdlaWdodC4KICogICogQml0bWFwIGZvbnRzIGdlbmVyYXRpb24gaW4gdGV4dHVyZSBhdGxhcyBmb3IgbW9yZSBvcHRpbWFsIHJlbmRlcmluZy4KICovCmV4cG9ydCBjbGFzcyBUZXh0UmVuZGVyZXIgewogIC8qKgogICAqIEBwYXJhbSBmb250RmV0Y2hlcnMgez9GdW5jdGlvbltdfSBMaXN0IG9mIGZvbnQgZmV0Y2hlcnMuIEZldGNoZXIgc2hvdWxkIHJldHVybiBwcm9taXNlIHdpdGgKICAgKiAgbG9hZGVkIGZvbnQgb2JqZWN0IChvcGVudHlwZS5qcykuIFRoZXkgYXJlIGludm9rZWQgb25seSB3aGVuIG5lY2Vzc2FyeS4gRWFjaCBnbHlwaCBpcyBiZWluZwogICAqICBzZWFyY2hlZCBzZXF1ZW50aWFsbHkgaW4gZWFjaCBwcm92aWRlZCBmb250LgogICAqIEBwYXJhbSBvcHRpb25zIHs/e319IFNlZSBUZXh0UmVuZGVyZXIuRGVmYXVsdE9wdGlvbnMuCiAgICovCiAgY29uc3RydWN0b3IoZm9udEZldGNoZXJzLCBvcHRpb25zID0gbnVsbCkgewogICAgdGhpcy5mb250RmV0Y2hlcnMgPSBmb250RmV0Y2hlcnM7CiAgICB0aGlzLmZvbnRzID0gW107CiAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuY3JlYXRlKFRleHRSZW5kZXJlci5EZWZhdWx0T3B0aW9ucyk7CiAgICBpZiAob3B0aW9ucykgewogICAgICBPYmplY3QuYXNzaWduKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CiAgICB9CiAgICAvKiBJbmRleGVkIGJ5IGNoYXJhY3RlciwgdmFsdWUgaXMgQ2hhclNoYXBlLiAqLwogICAgdGhpcy5zaGFwZXMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnN0dWJTaGFwZUxvYWRlZCA9IGZhbHNlOwogICAgLyogU2hhcGUgdG8gZGlzcGxheSBpZiBubyBnbHlwaCBmb3VuZCBpbiB0aGUgc3BlY2lmaWVkIGZvbnRzLiBNYXkgYmUgbnVsbCBpZiBmYWxsYmFjawogICAgICogY2hhcmFjdGVyIGNhbiBub3QgYmUgcmVuZGVyZWQgYXMgd2VsbC4KICAgICAqLwogICAgdGhpcy5zdHViU2hhcGUgPSBudWxsOwogIH0KCiAgLyoqIEZldGNoIG5lY2Vzc2FyeSBmb250cyB0byByZW5kZXIgdGhlIHByb3ZpZGVkIHRleHQuIFNob3VsZCBiZSBjYWxsZWQgZm9yIGVhY2ggc3RyaW5nIHdoaWNoCiAgICogd2lsbCBiZSByZW5kZXJlZCBsYXRlci4KICAgKiBAcGFyYW0gdGV4dCB7c3RyaW5nfQogICAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUgaWYgYWxsIGNoYXJhY3RlcnMgY2FuIGJlIHJlbmRlcmVkLCBmYWxzZSBpZiBub25lIG9mIHRoZSBwcm92aWRlZCBmb250cwogICAqICBjb250YWlucyBnbHlwaHMgZm9yIHNvbWUgb2YgdGhlIHNwZWNpZmllZCB0ZXh0IGNoYXJhY3RlcnMuCiAgICovCiAgYXN5bmMgRmV0Y2hGb250cyh0ZXh0KSB7CiAgICBpZiAoIXRoaXMuc3R1YlNoYXBlTG9hZGVkKSB7CiAgICAgIHRoaXMuc3R1YlNoYXBlTG9hZGVkID0gdHJ1ZTsKICAgICAgZm9yIChjb25zdCBjaGFyIG9mIEFycmF5LmZyb20odGhpcy5vcHRpb25zLmZhbGxiYWNrQ2hhcikpIHsKICAgICAgICBpZiAoYXdhaXQgdGhpcy5GZXRjaEZvbnRzKGNoYXIpKSB7CiAgICAgICAgICB0aGlzLnN0dWJTaGFwZSA9IHRoaXMuX0NyZWF0ZUNoYXJTaGFwZShjaGFyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IGNoYXJNaXNzaW5nID0gZmFsc2U7CiAgICBmb3IgKGNvbnN0IGNoYXIgb2YgdGV4dCkgewogICAgICBpZiAoY2hhci5jb2RlUG9pbnRBdCgwKSA8IDB4MjApIHsKICAgICAgICAvKiBDb250cm9sIGNoYXJhY3Rlci4gKi8KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgZm9yIChjb25zdCBmb250IG9mIHRoaXMuZm9udHMpIHsKICAgICAgICBpZiAoZm9udC5IYXNDaGFyKGNoYXIpKSB7CiAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGZvdW5kKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmZvbnRGZXRjaGVycykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB3aGlsZSAodGhpcy5mb250RmV0Y2hlcnMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGZldGNoZXIgPSB0aGlzLmZvbnRGZXRjaGVycy5zaGlmdCgpOwogICAgICAgIGNvbnN0IGZvbnQgPSBhd2FpdCB0aGlzLl9GZXRjaEZvbnQoZmV0Y2hlcik7CiAgICAgICAgdGhpcy5mb250cy5wdXNoKGZvbnQpOwogICAgICAgIGlmIChmb250Lkhhc0NoYXIoY2hhcikpIHsKICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgY2hhck1pc3NpbmcgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gIWNoYXJNaXNzaW5nOwogIH0KICBnZXQgY2FuUmVuZGVyKCkgewogICAgcmV0dXJuIHRoaXMuZm9udHMgIT09IG51bGwgJiYgdGhpcy5mb250cy5sZW5ndGggPiAwOwogIH0KCiAgLyoqIEdldCB3aWR0aCBpbiBtb2RlbCBzcGFjZSB1bml0cyBmb3IgYSBzaW5nbGUgbGluZSBvZiB0ZXh0LgogICAqIEBwYXJhbSB0ZXh0IHtzdHJpbmd9CiAgICogQHBhcmFtIGZvbnRTaXplIHtudW1iZXJ9CiAgICovCiAgR2V0TGluZVdpZHRoKHRleHQsIGZvbnRTaXplKSB7CiAgICBjb25zdCBibG9jayA9IG5ldyBUZXh0QmxvY2soZm9udFNpemUpOwogICAgZm9yIChjb25zdCBjaGFyIG9mIHRleHQpIHsKICAgICAgY29uc3Qgc2hhcGUgPSB0aGlzLl9HZXRDaGFyU2hhcGUoY2hhcik7CiAgICAgIGlmICghc2hhcGUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBibG9jay5QdXNoQ2hhcihjaGFyLCBzaGFwZSk7CiAgICB9CiAgICByZXR1cm4gYmxvY2suR2V0Q3VycmVudFBvc2l0aW9uKCk7CiAgfQoKICAvKioKICAgKiBAcGFyYW0gdGV4dCB7c3RyaW5nfQogICAqIEBwYXJhbSBzdGFydFBvcyB7e3gseX19CiAgICogQHBhcmFtIGVuZFBvcyB7P3t4LHl9fSBURVhUIGdyb3VwIHNlY29uZCBhbGlnbm1lbnQgcG9pbnQuCiAgICogQHBhcmFtIHJvdGF0aW9uIHs/bnVtYmVyfSBSb3RhdGlvbiBhdHRyaWJ1dGUsIGRlZy4KICAgKiBAcGFyYW0gd2lkdGhGYWN0b3Igez9udW1iZXJ9IFJlbGF0aXZlIFggc2NhbGUgZmFjdG9yIChncm91cCA0MSkKICAgKiBAcGFyYW0gaEFsaWduIHs/bnVtYmVyfSBIb3Jpem9udGFsIHRleHQganVzdGlmaWNhdGlvbiB0eXBlIGNvZGUgKGdyb3VwIDcyKQogICAqIEBwYXJhbSB2QWxpZ24gez9udW1iZXJ9IFZlcnRpY2FsIHRleHQganVzdGlmaWNhdGlvbiB0eXBlIGNvZGUgKGdyb3VwIDczKS4KICAgKiBAcGFyYW0gY29sb3Ige251bWJlcn0KICAgKiBAcGFyYW0gbGF5ZXIgez9zdHJpbmd9CiAgICogQHBhcmFtIGZvbnRTaXplIHtudW1iZXJ9CiAgICogQHJldHVybiB7R2VuZXJhdG9yPEVudGl0eT59IFJlbmRlcmluZyBlbnRpdGllcy4gQ3VycmVudGx5IGp1c3QgaW5kZXhlZCB0cmlhbmdsZXMgZm9yIGVhY2gKICAgKiAgZ2x5cGguCiAgICovCiAgKlJlbmRlcih7CiAgICB0ZXh0LAogICAgc3RhcnRQb3MsCiAgICBlbmRQb3MsCiAgICByb3RhdGlvbiA9IDAsCiAgICB3aWR0aEZhY3RvciA9IDEsCiAgICBoQWxpZ24gPSAwLAogICAgdkFsaWduID0gMCwKICAgIGNvbG9yLAogICAgbGF5ZXIgPSBudWxsLAogICAgZm9udFNpemUKICB9KSB7CiAgICBjb25zdCBibG9jayA9IG5ldyBUZXh0QmxvY2soZm9udFNpemUpOwogICAgZm9yIChjb25zdCBjaGFyIG9mIHRleHQpIHsKICAgICAgY29uc3Qgc2hhcGUgPSB0aGlzLl9HZXRDaGFyU2hhcGUoY2hhcik7CiAgICAgIGlmICghc2hhcGUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBibG9jay5QdXNoQ2hhcihjaGFyLCBzaGFwZSk7CiAgICB9CiAgICB5aWVsZCogYmxvY2suUmVuZGVyKHN0YXJ0UG9zLCBlbmRQb3MsIHJvdGF0aW9uLCB3aWR0aEZhY3RvciwgaEFsaWduLCB2QWxpZ24sIGNvbG9yLCBsYXllcik7CiAgfQoKICAvKioKICAgKiBAcGFyYW0ge01UZXh0Rm9ybWF0RW50aXR5W119IGZvcm1hdHRlZFRleHQgUGFyc2VkIGZvcm1hdHRlZCB0ZXh0LgogICAqIEBwYXJhbSB7e3gsIHl9fSBwb3NpdGlvbiBJbnNlcnRpb24gcG9zaXRpb24uCiAgICogQHBhcmFtIHtOdW1iZXJ9IGZvbnRTaXplCiAgICogQHBhcmFtIHs/TnVtYmVyfSB3aWR0aCBUZXh0IGJsb2NrIHdpZHRoLCBubyB3cmFwcGluZyBpZiB1bmRlZmluZWQuCiAgICogQHBhcmFtIHs/TnVtYmVyfSByb3RhdGlvbiBUZXh0IGJsb2NrIHJvdGF0aW9uIGluIGRlZ3JlZXMuCiAgICogQHBhcmFtIHs/e3gsIHl9fSBkaXJlY3Rpb24gVGV4dCBibG9jayBvcmllbnRhdGlvbiBkZWZpbmVkIGFzIGRpcmVjdGlvbiB2ZWN0b3IuIFRha2VzIGEKICAgKiBwcmVjZWRlbmNlIG92ZXIgcm90YXRpb24gaWYgYm90aCBwcm92aWRlZC4KICAgKiBAcGFyYW0ge251bWJlcn0gYXR0YWNobWVudCBBdHRhY2htZW50IHBvaW50LCBvbmUgb2YgTVRleHRBdHRhY2htZW50IHZhbHVlcy4KICAgKiBAcGFyYW0gez9udW1iZXJ9IGxpbmVTcGFjaW5nIExpbmUgc3BhY2luZyByYXRpbyByZWxhdGl2ZSB0byBkZWZhdWx0IG9uZSAoNS8zIG9mIGZvbnQgc2l6ZSkuCiAgICogQHBhcmFtIHtudW1iZXJ9IGNvbG9yCiAgICogQHBhcmFtIHs/c3RyaW5nfSBsYXllcgogICAqIEByZXR1cm4ge0dlbmVyYXRvcjxFbnRpdHk+fSBSZW5kZXJpbmcgZW50aXRpZXMuIEN1cnJlbnRseSBqdXN0IGluZGV4ZWQgdHJpYW5nbGVzIGZvciBlYWNoCiAgICogIGdseXBoLgogICAqLwogICpSZW5kZXJNVGV4dCh7CiAgICBmb3JtYXR0ZWRUZXh0LAogICAgcG9zaXRpb24sCiAgICBmb250U2l6ZSwKICAgIHdpZHRoID0gbnVsbCwKICAgIHJvdGF0aW9uID0gMCwKICAgIGRpcmVjdGlvbiA9IG51bGwsCiAgICBhdHRhY2htZW50LAogICAgbGluZVNwYWNpbmcgPSAxLAogICAgY29sb3IsCiAgICBsYXllciA9IG51bGwKICB9KSB7CiAgICBjb25zdCBib3ggPSBuZXcgVGV4dEJveChmb250U2l6ZSwgdGhpcy5fR2V0Q2hhclNoYXBlLmJpbmQodGhpcykpOwogICAgYm94LkZlZWRUZXh0KGZvcm1hdHRlZFRleHQpOwogICAgeWllbGQqIGJveC5SZW5kZXIocG9zaXRpb24sIHdpZHRoLCByb3RhdGlvbiwgZGlyZWN0aW9uLCBhdHRhY2htZW50LCBsaW5lU3BhY2luZywgY29sb3IsIGxheWVyKTsKICB9CgogIC8qKiBAcmV0dXJuIHtDaGFyU2hhcGV9IFNoYXBlIGZvciB0aGUgc3BlY2lmaWVkIGNoYXJhY3Rlci4KICAgKiBFYWNoIHNoYXBlIGlzIGluZGV4ZWQgdHJpYW5nbGVzIG1lc2ggZm9yIGZvbnQgc2l6ZSAxLiBUaGV5IHNob3VsZCBiZSBmdXJ0aGVyIHRyYW5zZm9ybWVkIGFzCiAgICogbmVlZGVkLgogICAqLwogIF9HZXRDaGFyU2hhcGUoY2hhcikgewogICAgbGV0IHNoYXBlID0gdGhpcy5zaGFwZXMuZ2V0KGNoYXIpOwogICAgaWYgKHNoYXBlKSB7CiAgICAgIHJldHVybiBzaGFwZTsKICAgIH0KICAgIHNoYXBlID0gdGhpcy5fQ3JlYXRlQ2hhclNoYXBlKGNoYXIpOwogICAgdGhpcy5zaGFwZXMuc2V0KGNoYXIsIHNoYXBlKTsKICAgIHJldHVybiBzaGFwZTsKICB9CiAgX0NyZWF0ZUNoYXJTaGFwZShjaGFyKSB7CiAgICBmb3IgKGNvbnN0IGZvbnQgb2YgdGhpcy5mb250cykgewogICAgICBjb25zdCBwYXRoID0gZm9udC5HZXRDaGFyUGF0aChjaGFyKTsKICAgICAgaWYgKHBhdGgpIHsKICAgICAgICByZXR1cm4gbmV3IENoYXJTaGFwZShmb250LCBwYXRoLCB0aGlzLm9wdGlvbnMpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5zdHViU2hhcGU7CiAgfQogIGFzeW5jIF9GZXRjaEZvbnQoZm9udEZldGNoZXIpIHsKICAgIHJldHVybiBuZXcgRm9udChhd2FpdCBmb250RmV0Y2hlcigpKTsKICB9Cn0KVGV4dFJlbmRlcmVyLkRlZmF1bHRPcHRpb25zID0gewogIC8qKiBOdW1iZXIgb2Ygc2VnbWVudHMgZm9yIGVhY2ggY3VydmUgaW4gYSBnbHlwaC4gQ3VycmVudGx5IFRocmVlLmpzIGRvZXMgbm90IGhhdmUgbW9yZQogICAqIGFkZXF1YXRlIGFuZ2xlLWJhc2VkIG9yIGxlbmd0aC1iYXNlZCB0ZXNzZWxsYXRpb24gb3B0aW9uLgogICAqLwogIGN1cnZlU3ViZGl2aXNpb246IDIsCiAgLyoqIENoYXJhY3RlciB0byB1c2Ugd2hlbiB0aGUgc3BlY2lmaWVkIGZvbnRzIGRvZXMgbm90IGNvbnRhaW4gbmVjZXNzYXJ5IGdseXBoLiBTZXZlcmFsIG9uZXMgY2FuCiAgICogYmUgc3BlY2lmaWVkLCB0aGUgZmlyc3Qgb25lIGF2YWlsYWJsZSBpcyB1c2VkLgogICAqLwogIGZhbGxiYWNrQ2hhcjogIlx1RkZGRD8iCn07CgovKiogQHR5cGVkZWYge09iamVjdH0gQ2hhclBhdGgKICogQHByb3BlcnR5IGFkdmFuY2Uge251bWJlcn0KICogQHByb3BlcnR5IHBhdGggez9TaGFwZVBhdGh9CiAqIEBwcm9wZXJ0eSBib3VuZHMge3hNaW46IG51bWJlciwgeE1heDogbnVtYmVyLCB5TWluOiBudW1iZXIsIHlNYXg6IG51bWJlcn0KICovCgpjbGFzcyBDaGFyU2hhcGUgewogIC8qKgogICAqIEBwYXJhbSBmb250IHtGb250fQogICAqIEBwYXJhbSBnbHlwaCB7Q2hhclBhdGh9CiAgICogQHBhcmFtIG9wdGlvbnMge3t9fSBSZW5kZXJlciBvcHRpb25zLgogICAqLwogIGNvbnN0cnVjdG9yKGZvbnQsIGdseXBoLCBvcHRpb25zKSB7CiAgICB0aGlzLmZvbnQgPSBmb250OwogICAgdGhpcy5hZHZhbmNlID0gZ2x5cGguYWR2YW5jZTsKICAgIHRoaXMuYm91bmRzID0gZ2x5cGguYm91bmRzOwogICAgaWYgKGdseXBoLnBhdGgpIHsKICAgICAgY29uc3Qgc2hhcGVzID0gZ2x5cGgucGF0aC50b1NoYXBlcyhmYWxzZSk7CiAgICAgIHRoaXMudmVydGljZXMgPSBbXTsKICAgICAgdGhpcy5pbmRpY2VzID0gW107CiAgICAgIGZvciAoY29uc3Qgc2hhcGUgb2Ygc2hhcGVzKSB7CiAgICAgICAgY29uc3Qgc2hhcGVQb2ludHMgPSBzaGFwZS5leHRyYWN0UG9pbnRzKG9wdGlvbnMuY3VydmVTdWJkaXZpc2lvbik7CiAgICAgICAgLyogRW5zdXJlIHByb3BlciB2ZXJ0aWNlcyB3aW5kaW5nLiAqLwogICAgICAgIGlmICghU2hhcGVVdGlscy5pc0Nsb2NrV2lzZShzaGFwZVBvaW50cy5zaGFwZSkpIHsKICAgICAgICAgIHNoYXBlUG9pbnRzLnNoYXBlID0gc2hhcGVQb2ludHMuc2hhcGUucmV2ZXJzZSgpOwogICAgICAgICAgZm9yIChjb25zdCBob2xlIG9mIHNoYXBlUG9pbnRzLmhvbGVzKSB7CiAgICAgICAgICAgIGlmIChTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlKGhvbGUpKSB7CiAgICAgICAgICAgICAgc2hhcGVQb2ludHMuaG9sZXNbaF0gPSBob2xlLnJldmVyc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKiBUaGlzIGNhbGwgYWxzbyByZW1vdmVzIGR1cGxpY2F0ZWQgZW5kIHZlcnRpY2VzLiAqLwogICAgICAgIGNvbnN0IGluZGljZXMgPSBTaGFwZVV0aWxzLnRyaWFuZ3VsYXRlU2hhcGUoc2hhcGVQb2ludHMuc2hhcGUsIHNoYXBlUG9pbnRzLmhvbGVzKTsKICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXM7CiAgICAgICAgY29uc3QgYmFzZUlkeCA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICAgIGZ1bmN0aW9uIEFkZFZlcnRpY2VzKHZlcnRpY2VzKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdmVydGljZXMpIHsKICAgICAgICAgICAgX3RoaXMudmVydGljZXMucHVzaCh2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQWRkVmVydGljZXMoc2hhcGVQb2ludHMuc2hhcGUpOwogICAgICAgIGZvciAoY29uc3QgaG9sZSBvZiBzaGFwZVBvaW50cy5ob2xlcykgewogICAgICAgICAgQWRkVmVydGljZXMoaG9sZSk7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgdHVwbGUgb2YgaW5kaWNlcykgewogICAgICAgICAgZm9yIChjb25zdCBpZHggb2YgdHVwbGUpIHsKICAgICAgICAgICAgdGhpcy5pbmRpY2VzLnB1c2goYmFzZUlkeCArIGlkeCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLnZlcnRpY2VzID0gbnVsbDsKICAgIH0KICB9CgogIC8qKiBHZXQgdmVydGljZXMgYXJyYXkgdHJhbnNmb3JtZWQgdG8gdGhlIHNwZWNpZmllZCBwb3NpdGlvbiBhbmQgd2l0aCB0aGUgc3BlY2lmaWVkIHNpemUuCiAgICogQHBhcmFtIHBvc2l0aW9uIHt7eCx5fX0KICAgKiBAcGFyYW0gc2l6ZSB7bnVtYmVyfQogICAqIEByZXR1cm4ge1ZlY3RvcjJbXX0KICAgKi8KICBHZXRWZXJ0aWNlcyhwb3NpdGlvbiwgc2l6ZSkgewogICAgcmV0dXJuIHRoaXMudmVydGljZXMubWFwKHYgPT4gdi5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKHNpemUpLmFkZChwb3NpdGlvbikpOwogIH0KfQpjbGFzcyBGb250IHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5jaGFyTWFwID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBnbHlwaCBvZiBPYmplY3QudmFsdWVzKGRhdGEuZ2x5cGhzLmdseXBocykpIHsKICAgICAgaWYgKGdseXBoLnVuaWNvZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRoaXMuY2hhck1hcC5zZXQoU3RyaW5nLmZyb21Db2RlUG9pbnQoZ2x5cGgudW5pY29kZSksIGdseXBoKTsKICAgIH0KICAgIC8qIFNjYWxlIHRvIHRyYW5zZm9ybSB0aGUgcGF0aHMgdG8gc2l6ZSAxLiAqLwogICAgLy9YWFggbm90IHJlYWxseSBjbGVhciB3aGF0IGlzIHRoZSByZXN1bHRpbmcgdW5pdCwgY2hlY2ssIHJldmlldyBhbmQgY29tbWVudCBpdCBsYXRlcgogICAgLy8gKDEwMHB4PykKICAgIHRoaXMuc2NhbGUgPSAxMDAgLyAoKHRoaXMuZGF0YS51bml0c1BlckVtIHx8IDIwNDgpICogNzIpOwogIH0KCiAgLyoqCiAgICogQHBhcmFtIGNoYXIge3N0cmluZ30gQ2hhcmFjdGVyIGNvZGUgcG9pbnQgYXMgc3RyaW5nLgogICAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUgaWYgdGhlIGZvbnQgaGFzIGdseXBocyBmb3IgdGhlIHNwZWNpZmllZCBjaGFyYWN0ZXIuCiAgICovCiAgSGFzQ2hhcihjaGFyKSB7CiAgICByZXR1cm4gdGhpcy5jaGFyTWFwLmhhcyhjaGFyKTsKICB9CgogIC8qKgogICAqIEBwYXJhbSBjaGFyIHtzdHJpbmd9IENoYXJhY3RlciBjb2RlIHBvaW50IGFzIHN0cmluZy4KICAgKiBAcmV0dXJuIHs/Q2hhclBhdGh9IFBhdGggaXMgc2NhbGVkIHRvIHNpemUgMS4gTnVsbCBpZiBubyBnbHlwaHMgZm9yIHRoZSBzcGVjaWZpZWQgY2hhcmFjdGVycy4KICAgKi8KICBHZXRDaGFyUGF0aChjaGFyKSB7CiAgICBjb25zdCBnbHlwaCA9IHRoaXMuY2hhck1hcC5nZXQoY2hhcik7CiAgICBpZiAoIWdseXBoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgY29uc3QgcGF0aCA9IG5ldyBTaGFwZVBhdGgoKTsKICAgIGZvciAoY29uc3QgY21kIG9mIGdseXBoLnBhdGguY29tbWFuZHMpIHsKICAgICAgc3dpdGNoIChjbWQudHlwZSkgewogICAgICAgIGNhc2UgJ00nOgogICAgICAgICAgcGF0aC5tb3ZlVG8oY21kLnggKiBzY2FsZSwgY21kLnkgKiBzY2FsZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdMJzoKICAgICAgICAgIHBhdGgubGluZVRvKGNtZC54ICogc2NhbGUsIGNtZC55ICogc2NhbGUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnUSc6CiAgICAgICAgICBwYXRoLnF1YWRyYXRpY0N1cnZlVG8oY21kLngxICogc2NhbGUsIGNtZC55MSAqIHNjYWxlLCBjbWQueCAqIHNjYWxlLCBjbWQueSAqIHNjYWxlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ0MnOgogICAgICAgICAgcGF0aC5iZXppZXJDdXJ2ZVRvKGNtZC54MSAqIHNjYWxlLCBjbWQueTEgKiBzY2FsZSwgY21kLngyICogc2NhbGUsIGNtZC55MiAqIHNjYWxlLCBjbWQueCAqIHNjYWxlLCBjbWQueSAqIHNjYWxlKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBhZHZhbmNlOiBnbHlwaC5hZHZhbmNlV2lkdGggKiBzY2FsZSwKICAgICAgcGF0aCwKICAgICAgYm91bmRzOiB7CiAgICAgICAgeE1pbjogZ2x5cGgueE1pbiAqIHNjYWxlLAogICAgICAgIHhNYXg6IGdseXBoLnhNYXggKiBzY2FsZSwKICAgICAgICB5TWluOiBnbHlwaC55TWluICogc2NhbGUsCiAgICAgICAgeU1heDogZ2x5cGgueU1heCAqIHNjYWxlCiAgICAgIH0KICAgIH07CiAgfQoKICAvKioKICAgKiBAcGFyYW0gYzEge3N0cmluZ30KICAgKiBAcGFyYW0gYzIge3N0cmluZ30KICAgKiBAcmV0dXJuIHtudW1iZXJ9CiAgICovCiAgR2V0S2VybmluZyhjMSwgYzIpIHsKICAgIGNvbnN0IGkxID0gdGhpcy5kYXRhLmNoYXJUb0dseXBoSW5kZXgoYzEpOwogICAgaWYgKGkxID09PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgY29uc3QgaTIgPSB0aGlzLmRhdGEuY2hhclRvR2x5cGhJbmRleChjMSk7CiAgICBpZiAoaTIgPT09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICByZXR1cm4gdGhpcy5kYXRhLmdldEtlcm5pbmdWYWx1ZShpMSwgaTIpICogdGhpcy5zY2FsZTsKICB9Cn0KCi8qKiBURVhUIGdyb3VwIGF0dHJpYnV0ZSA3MiB2YWx1ZXMuICovCmV4cG9ydCBjb25zdCBIQWxpZ24gPSBPYmplY3QuZnJlZXplKHsKICBMRUZUOiAwLAogIENFTlRFUjogMSwKICBSSUdIVDogMiwKICBBTElHTkVEOiAzLAogIE1JRERMRTogNCwKICBGSVQ6IDUKfSk7CgovKiogVEVYVCBncm91cCBhdHRyaWJ1dGUgNzMgdmFsdWVzLiAqLwpleHBvcnQgY29uc3QgVkFsaWduID0gT2JqZWN0LmZyZWV6ZSh7CiAgQkFTRUxJTkU6IDAsCiAgQk9UVE9NOiAxLAogIE1JRERMRTogMiwKICBUT1A6IDMKfSk7CgovKiogTVRFWFQgZ3JvdXAgYXR0cmlidXRlIDcxIHZhbHVlcy4gKi8KY29uc3QgTVRleHRBdHRhY2htZW50ID0gT2JqZWN0LmZyZWV6ZSh7CiAgVE9QX0xFRlQ6IDEsCiAgVE9QX0NFTlRFUjogMiwKICBUT1BfUklHSFQ6IDMsCiAgTUlERExFX0xFRlQ6IDQsCiAgTUlERExFX0NFTlRFUjogNSwKICBNSURETEVfUklHSFQ6IDYsCiAgQk9UVE9NX0xFRlQ6IDcsCiAgQk9UVE9NX0NFTlRFUjogOCwKICBCT1RUT01fUklHSFQ6IDkKfSk7CgovKiogRW5jYXBzdWxhdGVzIGxheW91dCBjYWxjdWxhdGlvbnMgZm9yIGEgbXVsdGlsaW5lLWxpbmUgdGV4dCBibG9jay4gKi8KY2xhc3MgVGV4dEJveCB7CiAgLyoqCiAgICogQHBhcmFtIGZvbnRTaXplCiAgICogQHBhcmFtIHtGdW5jdGlvbjxDaGFyU2hhcGUsIFN0cmluZz59IGNoYXJTaGFwZVByb3ZpZGVyCiAgICovCiAgY29uc3RydWN0b3IoZm9udFNpemUsIGNoYXJTaGFwZVByb3ZpZGVyKSB7CiAgICB0aGlzLmZvbnRTaXplID0gZm9udFNpemU7CiAgICB0aGlzLmNoYXJTaGFwZVByb3ZpZGVyID0gY2hhclNoYXBlUHJvdmlkZXI7CiAgICB0aGlzLmN1clBhcmFncmFwaCA9IG5ldyBUZXh0Qm94LlBhcmFncmFwaCh0aGlzKTsKICAgIHRoaXMucGFyYWdyYXBocyA9IFt0aGlzLmN1clBhcmFncmFwaF07CiAgICB0aGlzLnNwYWNlU2hhcGUgPSBjaGFyU2hhcGVQcm92aWRlcigiICIpOwogIH0KCiAgLyoqIEFkZCBzb21lIGZvcm1hdHRlZCB0ZXh0IHRvIHRoZSBib3guCiAgICogQHBhcmFtIHtNVGV4dEZvcm1hdEVudGl0eVtdfSBmb3JtYXR0ZWRUZXh0IFBhcnNlZCBmb3JtYXR0ZWQgdGV4dC4KICAgKi8KICBGZWVkVGV4dChmb3JtYXR0ZWRUZXh0KSB7CiAgICAvKiBGb3Igbm93IGFkdmFuY2VkIGZvcm1hdHRpbmcgaXMgbm90IGltcGxlbWVudGVkIHNvIHNjb3BlcyBhcmUganVzdCBmbGF0dGVuZWQuICovCiAgICBmdW5jdGlvbiogRmxhdHRlbkl0ZW1zKGl0ZW1zKSB7CiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykgewogICAgICAgIGlmIChpdGVtLnR5cGUgPT09IE1UZXh0Rm9ybWF0UGFyc2VyLkVudGl0eVR5cGUuU0NPUEUpIHsKICAgICAgICAgIHlpZWxkKiBGbGF0dGVuSXRlbXMoaXRlbS5jb250ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgeWllbGQgaXRlbTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvKiBOdWxsIGlzIGRlZmF1bHQgYWxpZ25tZW50IHdoaWNoIGRlcGVuZHMgb24gYXR0YWNobWVudCBwb2ludC4gKi8KICAgIGxldCBjdXJBbGlnbm1lbnQgPSBudWxsOwogICAgZm9yIChjb25zdCBpdGVtIG9mIEZsYXR0ZW5JdGVtcyhmb3JtYXR0ZWRUZXh0KSkgewogICAgICBzd2l0Y2ggKGl0ZW0udHlwZSkgewogICAgICAgIGNhc2UgTVRleHRGb3JtYXRQYXJzZXIuRW50aXR5VHlwZS5URVhUOgogICAgICAgICAgZm9yIChjb25zdCBjIG9mIGl0ZW0uY29udGVudCkgewogICAgICAgICAgICBpZiAoYyA9PT0gIiAiKSB7CiAgICAgICAgICAgICAgdGhpcy5jdXJQYXJhZ3JhcGguRmVlZFNwYWNlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5jdXJQYXJhZ3JhcGguRmVlZENoYXIoYyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTVRleHRGb3JtYXRQYXJzZXIuRW50aXR5VHlwZS5QQVJBR1JBUEg6CiAgICAgICAgICB0aGlzLmN1clBhcmFncmFwaCA9IG5ldyBUZXh0Qm94LlBhcmFncmFwaCh0aGlzKTsKICAgICAgICAgIHRoaXMuY3VyUGFyYWdyYXBoLlNldEFsaWdubWVudChjdXJBbGlnbm1lbnQpOwogICAgICAgICAgdGhpcy5wYXJhZ3JhcGhzLnB1c2godGhpcy5jdXJQYXJhZ3JhcGgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBNVGV4dEZvcm1hdFBhcnNlci5FbnRpdHlUeXBlLk5PTl9CUkVBS0lOR19TUEFDRToKICAgICAgICAgIHRoaXMuY3VyUGFyYWdyYXBoLkZlZWRDaGFyKCIgIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIE1UZXh0Rm9ybWF0UGFyc2VyLkVudGl0eVR5cGUuUEFSQUdSQVBIX0FMSUdOTUVOVDoKICAgICAgICAgIGxldCBhID0gbnVsbDsKICAgICAgICAgIHN3aXRjaCAoaXRlbS5hbGlnbm1lbnQpIHsKICAgICAgICAgICAgY2FzZSAibCI6CiAgICAgICAgICAgICAgYSA9IFRleHRCb3guUGFyYWdyYXBoLkFsaWdubWVudC5MRUZUOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJjIjoKICAgICAgICAgICAgICBhID0gVGV4dEJveC5QYXJhZ3JhcGguQWxpZ25tZW50LkNFTlRFUjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiciI6CiAgICAgICAgICAgICAgYSA9IFRleHRCb3guUGFyYWdyYXBoLkFsaWdubWVudC5SSUdIVDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiZCI6CiAgICAgICAgICAgICAgYSA9IFRleHRCb3guUGFyYWdyYXBoLkFsaWdubWVudC5KVVNUSUZZOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJqIjoKICAgICAgICAgICAgICBhID0gbnVsbDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuY3VyUGFyYWdyYXBoLlNldEFsaWdubWVudChhKTsKICAgICAgICAgIGN1ckFsaWdubWVudCA9IGE7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KICAqUmVuZGVyKHBvc2l0aW9uLCB3aWR0aCwgcm90YXRpb24sIGRpcmVjdGlvbiwgYXR0YWNobWVudCwgbGluZVNwYWNpbmcsIGNvbG9yLCBsYXllcikgewogICAgZm9yIChjb25zdCBwIG9mIHRoaXMucGFyYWdyYXBocykgewogICAgICBwLkJ1aWxkTGluZXMod2lkdGgpOwogICAgfQogICAgaWYgKHdpZHRoID09PSBudWxsIHx8IHdpZHRoID09PSAwKSB7CiAgICAgIC8qIEZpbmQgbWF4aW1hbCBwYXJhZ3JhcGggd2lkdGggd2hpY2ggd2lsbCBkZWZpbmUgb3ZlcmFsbCBib3ggd2lkdGguICovCiAgICAgIHdpZHRoID0gMDsKICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMucGFyYWdyYXBocykgewogICAgICAgIGNvbnN0IHBXaWR0aCA9IHAuR2V0TWF4TGluZVdpZHRoKCk7CiAgICAgICAgaWYgKHBXaWR0aCA+IHdpZHRoKSB7CiAgICAgICAgICB3aWR0aCA9IHBXaWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGxldCBkZWZhdWx0QWxpZ25tZW50ID0gVGV4dEJveC5QYXJhZ3JhcGguQWxpZ25tZW50LkxFRlQ7CiAgICBzd2l0Y2ggKGF0dGFjaG1lbnQpIHsKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuVE9QX0NFTlRFUjoKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuTUlERExFX0NFTlRFUjoKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuQk9UVE9NX0NFTlRFUjoKICAgICAgICBkZWZhdWx0QWxpZ25tZW50ID0gVGV4dEJveC5QYXJhZ3JhcGguQWxpZ25tZW50LkNFTlRFUjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuVE9QX1JJR0hUOgogICAgICBjYXNlIE1UZXh0QXR0YWNobWVudC5NSURETEVfUklHSFQ6CiAgICAgIGNhc2UgTVRleHRBdHRhY2htZW50LkJPVFRPTV9SSUdIVDoKICAgICAgICBkZWZhdWx0QWxpZ25tZW50ID0gVGV4dEJveC5QYXJhZ3JhcGguQWxpZ25tZW50LlJJR0hUOwogICAgICAgIGJyZWFrOwogICAgfQogICAgZm9yIChjb25zdCBwIG9mIHRoaXMucGFyYWdyYXBocykgewogICAgICBwLkFwcGx5QWxpZ25tZW50KHdpZHRoLCBkZWZhdWx0QWxpZ25tZW50KTsKICAgIH0KCiAgICAvKiBCb3ggbG9jYWwgY29vcmRpbmF0ZXMgaGF2ZSB0b3AtbGVmdCBjb3JuZXIgb3JpZ2luLCBzbyBZIHZhbHVlcyBhcmUgbmVnYXRpdmUuIFRoZQogICAgICogc3BlY2lmaWVkIGF0dGFjaG1lbnQgc2hvdWxkIGJlIHVzZWQgdG8gb2J0YWluIGF0dGFjaG1lbnQgcG9pbnQgb2Zmc2V0IHJlbGF0aXZlbHkgdG8gYm94CiAgICAgKiBDUyBvcmlnaW4uCiAgICAgKi8KCiAgICBpZiAoZGlyZWN0aW9uICE9PSBudWxsKSB7CiAgICAgIC8qIERpcmVjdGlvbiB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgcm90YXRpb24gaWYgc3BlY2lmaWVkLiAqLwogICAgICByb3RhdGlvbiA9IE1hdGguYXRhbjIoZGlyZWN0aW9uLnksIGRpcmVjdGlvbi54KSAqIDE4MCAvIE1hdGguUEk7CiAgICB9CiAgICBjb25zdCBsaW5lSGVpZ2h0ID0gbGluZVNwYWNpbmcgKiA1ICogdGhpcy5mb250U2l6ZSAvIDM7CiAgICBsZXQgaGVpZ2h0ID0gMDsKICAgIGZvciAoY29uc3QgcCBvZiB0aGlzLnBhcmFncmFwaHMpIHsKICAgICAgaWYgKHAubGluZXMgPT09IG51bGwpIHsKICAgICAgICAvKiBQYXJhZ3JhcGggYWx3YXlzIG9jY3VwaWVzIGF0IGxlYXN0IG9uZSBsaW5lLiAqLwogICAgICAgIGhlaWdodCsrOwogICAgICB9IGVsc2UgewogICAgICAgIGhlaWdodCArPSBwLmxpbmVzLmxlbmd0aDsKICAgICAgfQogICAgfQogICAgaGVpZ2h0ICo9IGxpbmVIZWlnaHQ7CiAgICBsZXQgb3JpZ2luID0gbmV3IFZlY3RvcjIoKTsKICAgIHN3aXRjaCAoYXR0YWNobWVudCkgewogICAgICBjYXNlIE1UZXh0QXR0YWNobWVudC5UT1BfTEVGVDoKICAgICAgICBicmVhazsKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuVE9QX0NFTlRFUjoKICAgICAgICBvcmlnaW4ueCA9IHdpZHRoIC8gMjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuVE9QX1JJR0hUOgogICAgICAgIG9yaWdpbi54ID0gd2lkdGg7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgTVRleHRBdHRhY2htZW50Lk1JRERMRV9MRUZUOgogICAgICAgIG9yaWdpbi55ID0gLWhlaWdodCAvIDI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgTVRleHRBdHRhY2htZW50Lk1JRERMRV9DRU5URVI6CiAgICAgICAgb3JpZ2luLnggPSB3aWR0aCAvIDI7CiAgICAgICAgb3JpZ2luLnkgPSAtaGVpZ2h0IC8gMjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuTUlERExFX1JJR0hUOgogICAgICAgIG9yaWdpbi54ID0gd2lkdGg7CiAgICAgICAgb3JpZ2luLnkgPSAtaGVpZ2h0IC8gMjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuQk9UVE9NX0xFRlQ6CiAgICAgICAgb3JpZ2luLnkgPSAtaGVpZ2h0OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIE1UZXh0QXR0YWNobWVudC5CT1RUT01fQ0VOVEVSOgogICAgICAgIG9yaWdpbi54ID0gd2lkdGggLyAyOwogICAgICAgIG9yaWdpbi55ID0gLWhlaWdodDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBNVGV4dEF0dGFjaG1lbnQuQk9UVE9NX1JJR0hUOgogICAgICAgIG9yaWdpbi54ID0gd2lkdGg7CiAgICAgICAgb3JpZ2luLnkgPSAtaGVpZ2h0OwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5oYW5kbGVkIGFsaWdubWVudCIpOwogICAgfQoKICAgIC8qIFRyYW5zZm9ybSBmb3IgZWFjaCBjaHVuayBpbnNlcnRpb24gcG9pbnQuICovCiAgICBjb25zdCB0cmFuc2Zvcm0gPSBuZXcgTWF0cml4MygpLnRyYW5zbGF0ZSgtb3JpZ2luLngsIC1vcmlnaW4ueSkucm90YXRlKC1yb3RhdGlvbiAqIE1hdGguUEkgLyAxODApLnRyYW5zbGF0ZShwb3NpdGlvbi54LCBwb3NpdGlvbi55KTsKICAgIGxldCB5ID0gLXRoaXMuZm9udFNpemU7CiAgICBmb3IgKGNvbnN0IHAgb2YgdGhpcy5wYXJhZ3JhcGhzKSB7CiAgICAgIGlmIChwLmxpbmVzID09PSBudWxsKSB7CiAgICAgICAgeSAtPSBsaW5lSGVpZ2h0OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBwLmxpbmVzKSB7CiAgICAgICAgZm9yIChsZXQgY2h1bmtJZHggPSBsaW5lLnN0YXJ0Q2h1bmtJZHg7IGNodW5rSWR4IDwgbGluZS5zdGFydENodW5rSWR4ICsgbGluZS5udW1DaHVua3M7IGNodW5rSWR4KyspIHsKICAgICAgICAgIGNvbnN0IGNodW5rID0gcC5jaHVua3NbY2h1bmtJZHhdOwogICAgICAgICAgbGV0IHggPSBjaHVuay5wb3NpdGlvbjsKICAgICAgICAgIC8qIEZpcnN0IGNodW5rIG9mIGNvbnRpbnVhdGlvbiBsaW5lIG5ldmVyIHByZXBlbmRlZCBieSB3aGl0ZXNwYWNlLiAqLwogICAgICAgICAgaWYgKGNodW5rSWR4ID09PSAwIHx8IGNodW5rSWR4ICE9PSBsaW5lLnN0YXJ0Q2h1bmtJZHgpIHsKICAgICAgICAgICAgeCArPSBjaHVuay5HZXRTcGFjaW5nV2lkdGgoKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHYgPSBuZXcgVmVjdG9yMih4LCB5KTsKICAgICAgICAgIHYuYXBwbHlNYXRyaXgzKHRyYW5zZm9ybSk7CiAgICAgICAgICBpZiAoY2h1bmsuYmxvY2spIHsKICAgICAgICAgICAgeWllbGQqIGNodW5rLmJsb2NrLlJlbmRlcih2LCBudWxsLCByb3RhdGlvbiwgbnVsbCwgSEFsaWduLkxFRlQsIFZBbGlnbi5CQVNFTElORSwgY29sb3IsIGxheWVyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgeSAtPSBsaW5lSGVpZ2h0OwogICAgICB9CiAgICB9CiAgfQp9ClRleHRCb3guUGFyYWdyYXBoID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKHRleHRCb3gpIHsKICAgIHRoaXMudGV4dEJveCA9IHRleHRCb3g7CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5jdXJDaHVuayA9IG51bGw7CiAgICB0aGlzLmFsaWdubWVudCA9IG51bGw7CiAgICB0aGlzLmxpbmVzID0gbnVsbDsKICB9CgogIC8qKiBGZWVkIGNoYXJhY3RlciBmb3IgY3VycmVudCBjaHVuay4gU3BhY2VzIHNob3VsZCBiZSBmZWQgYnkgRmVlZFNwYWNlKCkgbWV0aG9kLiBJZiBzcGFjZQogICAqIGNoYXJhY3RlciBpcyBmZWQgaW50byB0aGlzIG1ldGhvZCwgaXQgaXMgaW50ZXJwcmV0ZWQgYXMgbm9uLWJyZWFraW5nIHNwYWNlLgogICAqLwogIEZlZWRDaGFyKGMpIHsKICAgIGNvbnN0IHNoYXBlID0gdGhpcy50ZXh0Qm94LmNoYXJTaGFwZVByb3ZpZGVyKGMpOwogICAgaWYgKHNoYXBlID09PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLmN1ckNodW5rID09PSBudWxsKSB7CiAgICAgIHRoaXMuX0FkZENodW5rKCk7CiAgICB9CiAgICB0aGlzLmN1ckNodW5rLlB1c2hDaGFyKGMsIHNoYXBlKTsKICB9CiAgRmVlZFNwYWNlKCkgewogICAgaWYgKHRoaXMuY3VyQ2h1bmsgPT09IG51bGwgfHwgdGhpcy5jdXJDaHVuay5sYXN0Q2hhciAhPT0gbnVsbCkgewogICAgICB0aGlzLl9BZGRDaHVuaygpOwogICAgfQogICAgdGhpcy5jdXJDaHVuay5QdXNoU3BhY2UoKTsKICB9CiAgU2V0QWxpZ25tZW50KGFsaWdubWVudCkgewogICAgdGhpcy5hbGlnbm1lbnQgPSBhbGlnbm1lbnQ7CiAgfQoKICAvKiogR3JvdXAgY2h1bmtzIGludG8gbGluZXMuCiAgICoKICAgKiBAcGFyYW0gez9udW1iZXJ9IGJveFdpZHRoIEJveCB3aWR0aC4gRG8gbm90IHdyYXAgbGluZXMgaWYgbnVsbCAob25lIGxpbmUgaXMgY3JlYXRlZCkuCiAgICovCiAgQnVpbGRMaW5lcyhib3hXaWR0aCkgewogICAgaWYgKHRoaXMuY3VyQ2h1bmsgPT09IG51bGwpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5saW5lcyA9IFtdOwogICAgbGV0IHN0YXJ0Q2h1bmtJZHggPSAwOwogICAgbGV0IGN1ckNodW5rSWR4ID0gMDsKICAgIGxldCBjdXJXaWR0aCA9IDA7CiAgICBjb25zdCBDb21taXRMaW5lID0gKCkgPT4gewogICAgICB0aGlzLmxpbmVzLnB1c2gobmV3IFRleHRCb3guUGFyYWdyYXBoLkxpbmUodGhpcywgc3RhcnRDaHVua0lkeCwgY3VyQ2h1bmtJZHggLSBzdGFydENodW5rSWR4LCBjdXJXaWR0aCkpOwogICAgICBzdGFydENodW5rSWR4ID0gY3VyQ2h1bmtJZHg7CiAgICAgIGN1cldpZHRoID0gMDsKICAgIH07CiAgICBmb3IgKDsgY3VyQ2h1bmtJZHggPCB0aGlzLmNodW5rcy5sZW5ndGg7IGN1ckNodW5rSWR4KyspIHsKICAgICAgY29uc3QgY2h1bmsgPSB0aGlzLmNodW5rc1tjdXJDaHVua0lkeF07CiAgICAgIGNvbnN0IGNodW5rV2lkdGggPSBjaHVuay5HZXRXaWR0aChzdGFydENodW5rSWR4ID09PSAwIHx8IGN1ckNodW5rSWR4ICE9PSBzdGFydENodW5rSWR4KTsKICAgICAgaWYgKGJveFdpZHRoICE9PSBudWxsICYmIGJveFdpZHRoICE9PSAwICYmIGN1cldpZHRoICE9PSAwICYmIGN1cldpZHRoICsgY2h1bmtXaWR0aCA+IGJveFdpZHRoKSB7CiAgICAgICAgQ29tbWl0TGluZSgpOwogICAgICB9CiAgICAgIGNodW5rLnBvc2l0aW9uID0gY3VyV2lkdGg7CiAgICAgIGN1cldpZHRoICs9IGNodW5rV2lkdGg7CiAgICB9CiAgICBpZiAoc3RhcnRDaHVua0lkeCAhPT0gY3VyQ2h1bmtJZHggJiYgY3VyV2lkdGggIT09IDApIHsKICAgICAgQ29tbWl0TGluZSgpOwogICAgfQogIH0KICBHZXRNYXhMaW5lV2lkdGgoKSB7CiAgICBpZiAodGhpcy5saW5lcyA9PT0gbnVsbCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGxldCBtYXhXaWR0aCA9IDA7CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgdGhpcy5saW5lcykgewogICAgICBpZiAobGluZS53aWR0aCA+IG1heFdpZHRoKSB7CiAgICAgICAgbWF4V2lkdGggPSBsaW5lLndpZHRoOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWF4V2lkdGg7CiAgfQogIEFwcGx5QWxpZ25tZW50KGJveFdpZHRoLCBkZWZhdWx0QWxpZ25tZW50KSB7CiAgICBpZiAodGhpcy5saW5lcykgewogICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgdGhpcy5saW5lcykgewogICAgICAgIGxpbmUuQXBwbHlBbGlnbm1lbnQoYm94V2lkdGgsIGRlZmF1bHRBbGlnbm1lbnQpOwogICAgICB9CiAgICB9CiAgfQogIF9BZGRDaHVuaygpIHsKICAgIHRoaXMuY3VyQ2h1bmsgPSBuZXcgVGV4dEJveC5QYXJhZ3JhcGguQ2h1bmsodGhpcywgdGhpcy50ZXh0Qm94LmZvbnRTaXplLCB0aGlzLmN1ckNodW5rKTsKICAgIHRoaXMuY2h1bmtzLnB1c2godGhpcy5jdXJDaHVuayk7CiAgfQp9OwpUZXh0Qm94LlBhcmFncmFwaC5BbGlnbm1lbnQgPSBPYmplY3QuZnJlZXplKHsKICBMRUZUOiAwLAogIENFTlRFUjogMSwKICBSSUdIVDogMiwKICBKVVNUSUZZOiAzCn0pOwpUZXh0Qm94LlBhcmFncmFwaC5DaHVuayA9IGNsYXNzIHsKICAvKioKICAgKiBAcGFyYW0ge1RleHRCb3guUGFyYWdyYXBofSBwYXJhZ3JhcGgKICAgKiBAcGFyYW0ge251bWJlcn0gZm9udFNpemUKICAgKiBAcGFyYW0gez9UZXh0Qm94LlBhcmFncmFwaC5DaHVua30gcHJldkNodW5rCiAgICovCiAgY29uc3RydWN0b3IocGFyYWdyYXBoLCBmb250U2l6ZSwgcHJldkNodW5rKSB7CiAgICB0aGlzLnBhcmFncmFwaCA9IHBhcmFncmFwaDsKICAgIHRoaXMuZm9udFNpemUgPSBmb250U2l6ZTsKICAgIHRoaXMucHJldkNodW5rID0gcHJldkNodW5rOwogICAgdGhpcy5sYXN0Q2hhciA9IG51bGw7CiAgICB0aGlzLmxhc3RTaGFwZSA9IG51bGw7CiAgICB0aGlzLmxlYWRpbmdTcGFjZXMgPSAwOwogICAgdGhpcy5zcGFjZVN0YXJ0S2VybmluZyA9IG51bGw7CiAgICB0aGlzLnNwYWNlRW5kS2VybmluZyA9IG51bGw7CiAgICB0aGlzLmJsb2NrID0gbnVsbDsKICAgIHRoaXMucG9zaXRpb24gPSBudWxsOwogIH0KICBQdXNoU3BhY2UoKSB7CiAgICBpZiAodGhpcy5ibG9jaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIklsbGVnYWwgb3BlcmF0aW9uIik7CiAgICB9CiAgICB0aGlzLmxlYWRpbmdTcGFjZXMrKzsKICB9CgogIC8qKgogICAqIEBwYXJhbSBjaGFyIHtzdHJpbmd9CiAgICogQHBhcmFtIHNoYXBlIHtDaGFyU2hhcGV9CiAgICovCiAgUHVzaENoYXIoY2hhciwgc2hhcGUpIHsKICAgIGlmICh0aGlzLnNwYWNlU3RhcnRLZXJuaW5nID09PSBudWxsKSB7CiAgICAgIGlmICh0aGlzLmxlYWRpbmdTcGFjZXMgPT09IDApIHsKICAgICAgICB0aGlzLnNwYWNlU3RhcnRLZXJuaW5nID0gMDsKICAgICAgICB0aGlzLnNwYWNlRW5kS2VybmluZyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMucHJldkNodW5rICYmIHRoaXMucHJldkNodW5rLmxhc3RTaGFwZSAmJiB0aGlzLnByZXZDaHVuay5mb250U2l6ZSA9PT0gdGhpcy5mb250U2l6ZSAmJiB0aGlzLnByZXZDaHVuay5sYXN0U2hhcGUuZm9udCA9PT0gdGhpcy5wYXJhZ3JhcGgudGV4dEJveC5zcGFjZVNoYXBlLmZvbnQpIHsKICAgICAgICAgIHRoaXMuc3BhY2VTdGFydEtlcm5pbmcgPSB0aGlzLnByZXZDaHVuay5sYXN0U2hhcGUuZm9udC5HZXRLZXJuaW5nKHRoaXMucHJldkNodW5rLmxhc3RDaGFyLCAiICIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNwYWNlU3RhcnRLZXJuaW5nID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHNoYXBlLmZvbnQgPT09IHRoaXMucGFyYWdyYXBoLnRleHRCb3guc3BhY2VTaGFwZS5mb250KSB7CiAgICAgICAgICB0aGlzLnNwYWNlRW5kS2VybmluZyA9IHNoYXBlLmZvbnQuR2V0S2VybmluZygiICIsIGNoYXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNwYWNlRW5kS2VybmluZyA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5ibG9jayA9PT0gbnVsbCkgewogICAgICB0aGlzLmJsb2NrID0gbmV3IFRleHRCbG9jayh0aGlzLmZvbnRTaXplKTsKICAgIH0KICAgIHRoaXMuYmxvY2suUHVzaENoYXIoY2hhciwgc2hhcGUpOwogICAgdGhpcy5sYXN0Q2hhciA9IGNoYXI7CiAgICB0aGlzLmxhc3RTaGFwZSA9IHNoYXBlOwogIH0KICBHZXRTcGFjaW5nV2lkdGgoKSB7CiAgICByZXR1cm4gKHRoaXMubGVhZGluZ1NwYWNlcyAqIHRoaXMucGFyYWdyYXBoLnRleHRCb3guc3BhY2VTaGFwZS5hZHZhbmNlICsgdGhpcy5zcGFjZVN0YXJ0S2VybmluZyArIHRoaXMuc3BhY2VFbmRLZXJuaW5nKSAqIHRoaXMuZm9udFNpemU7CiAgfQogIEdldFdpZHRoKHdpdGhTcGFjaW5nKSB7CiAgICBpZiAodGhpcy5ibG9jayA9PT0gbnVsbCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGxldCB3aWR0aCA9IHRoaXMuYmxvY2suR2V0Q3VycmVudFBvc2l0aW9uKCk7CiAgICBpZiAod2l0aFNwYWNpbmcpIHsKICAgICAgd2lkdGggKz0gdGhpcy5HZXRTcGFjaW5nV2lkdGgoKTsKICAgIH0KICAgIHJldHVybiB3aWR0aDsKICB9Cn07ClRleHRCb3guUGFyYWdyYXBoLkxpbmUgPSBjbGFzcyB7CiAgY29uc3RydWN0b3IocGFyYWdyYXBoLCBzdGFydENodW5rSWR4LCBudW1DaHVua3MsIHdpZHRoKSB7CiAgICB0aGlzLnBhcmFncmFwaCA9IHBhcmFncmFwaDsKICAgIHRoaXMuc3RhcnRDaHVua0lkeCA9IHN0YXJ0Q2h1bmtJZHg7CiAgICB0aGlzLm51bUNodW5rcyA9IG51bUNodW5rczsKICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICB9CiAgQXBwbHlBbGlnbm1lbnQoYm94V2lkdGgsIGRlZmF1bHRBbGlnbm1lbnQpIHsKICAgIHZhciBfdGhpcyRwYXJhZ3JhcGgkYWxpZ247CiAgICBsZXQgYWxpZ25tZW50ID0gKF90aGlzJHBhcmFncmFwaCRhbGlnbiA9IHRoaXMucGFyYWdyYXBoLmFsaWdubWVudCkgIT09IG51bGwgJiYgX3RoaXMkcGFyYWdyYXBoJGFsaWduICE9PSB2b2lkIDAgPyBfdGhpcyRwYXJhZ3JhcGgkYWxpZ24gOiBkZWZhdWx0QWxpZ25tZW50OwogICAgc3dpdGNoIChhbGlnbm1lbnQpIHsKICAgICAgY2FzZSBUZXh0Qm94LlBhcmFncmFwaC5BbGlnbm1lbnQuTEVGVDoKICAgICAgICBicmVhazsKICAgICAgY2FzZSBUZXh0Qm94LlBhcmFncmFwaC5BbGlnbm1lbnQuQ0VOVEVSOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IG9mZnNldCA9IChib3hXaWR0aCAtIHRoaXMud2lkdGgpIC8gMjsKICAgICAgICAgIHRoaXMuRm9yRWFjaENodW5rKGNodW5rID0+IGNodW5rLnBvc2l0aW9uICs9IG9mZnNldCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgVGV4dEJveC5QYXJhZ3JhcGguQWxpZ25tZW50LlJJR0hUOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGJveFdpZHRoIC0gdGhpcy53aWR0aDsKICAgICAgICAgIHRoaXMuRm9yRWFjaENodW5rKGNodW5rID0+IGNodW5rLnBvc2l0aW9uICs9IG9mZnNldCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgVGV4dEJveC5QYXJhZ3JhcGguQWxpZ25tZW50LkpVU1RJRlk6CiAgICAgICAgewogICAgICAgICAgY29uc3Qgc3BhY2UgPSBib3hXaWR0aCAtIHRoaXMud2lkdGg7CiAgICAgICAgICBpZiAoc3BhY2UgPD0gMCB8fCB0aGlzLm51bUNodW5rcyA9PT0gMSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0ZXAgPSBzcGFjZSAvICh0aGlzLm51bUNodW5rcyAtIDEpOwogICAgICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgICAgICB0aGlzLkZvckVhY2hDaHVuayhjaHVuayA9PiB7CiAgICAgICAgICAgIGNodW5rLnBvc2l0aW9uICs9IG9mZnNldDsKICAgICAgICAgICAgb2Zmc2V0ICs9IHN0ZXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuaGFuZGxlZCBhbGlnbm1lbnQ6ICIgKyB0aGlzLnBhcmFncmFwaC5hbGlnbm1lbnQpOwogICAgfQogIH0KICBGb3JFYWNoQ2h1bmsoaGFuZGxlcikgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm51bUNodW5rczsgaSsrKSB7CiAgICAgIGhhbmRsZXIodGhpcy5wYXJhZ3JhcGguY2h1bmtzW3RoaXMuc3RhcnRDaHVua0lkeCArIGldKTsKICAgIH0KICB9Cn07CgovKiogRW5jYXBzdWxhdGVzIGNhbGN1bGF0aW9ucyBmb3IgYSBzaW5nbGUtbGluZSB0ZXh0IGJsb2NrLiAqLwpjbGFzcyBUZXh0QmxvY2sgewogIGNvbnN0cnVjdG9yKGZvbnRTaXplKSB7CiAgICB0aGlzLmZvbnRTaXplID0gZm9udFNpemU7CiAgICAvKiBFbGVtZW50IGlzIHtzaGFwZTogQ2hhclNoYXBlLCB2ZXJ0aWNlczogP3tWZWN0b3IyfVtdfSAqLwogICAgdGhpcy5nbHlwaHMgPSBbXTsKICAgIHRoaXMuYm91bmRzID0gbnVsbDsKICAgIHRoaXMuY3VyWCA9IDA7CiAgICB0aGlzLnByZXZDaGFyID0gbnVsbDsKICAgIHRoaXMucHJldkZvbnQgPSBudWxsOwogIH0KCiAgLyoqCiAgICogQHBhcmFtIGNoYXIge3N0cmluZ30KICAgKiBAcGFyYW0gc2hhcGUge0NoYXJTaGFwZX0KICAgKi8KICBQdXNoQ2hhcihjaGFyLCBzaGFwZSkgewogICAgLyogSW5pdGlhbGx5IHN0b3JlIHdpdGgganVzdCBmb250IHNpemUgYW5kIGNoYXJhY3RlcnMgcG9zaXRpb24gYXBwbGllZC4gT3JpZ2luIGlzIHRoZSBmaXJzdAogICAgICogY2hhcmFjdGVyIGJhc2UgcG9pbnQuCiAgICAgKi8KICAgIGxldCBvZmZzZXQ7CiAgICBpZiAodGhpcy5wcmV2Q2hhciAhPT0gbnVsbCAmJiB0aGlzLnByZXZGb250ID09PSBzaGFwZS5mb250KSB7CiAgICAgIG9mZnNldCA9IHRoaXMucHJldkZvbnQuR2V0S2VybmluZyh0aGlzLnByZXZDaGFyLCBjaGFyKTsKICAgIH0gZWxzZSB7CiAgICAgIG9mZnNldCA9IDA7CiAgICB9CiAgICBjb25zdCB4ID0gdGhpcy5jdXJYICsgb2Zmc2V0ICogdGhpcy5mb250U2l6ZTsKICAgIGxldCB2ZXJ0aWNlczsKICAgIGlmIChzaGFwZS52ZXJ0aWNlcykgewogICAgICB2ZXJ0aWNlcyA9IHNoYXBlLkdldFZlcnRpY2VzKHsKICAgICAgICB4LAogICAgICAgIHk6IDAKICAgICAgfSwgdGhpcy5mb250U2l6ZSk7CiAgICAgIGNvbnN0IHhNaW4gPSB4ICsgc2hhcGUuYm91bmRzLnhNaW4gKiB0aGlzLmZvbnRTaXplOwogICAgICBjb25zdCB4TWF4ID0geCArIHNoYXBlLmJvdW5kcy54TWF4ICogdGhpcy5mb250U2l6ZTsKICAgICAgY29uc3QgeU1pbiA9IHNoYXBlLmJvdW5kcy55TWluICogdGhpcy5mb250U2l6ZTsKICAgICAgY29uc3QgeU1heCA9IHNoYXBlLmJvdW5kcy55TWF4ICogdGhpcy5mb250U2l6ZTsKICAgICAgLyogTGVhZGluZy90cmFpbGluZyBzcGFjZXMgbm90IGFjY291bnRlZCBpbnRlbnRpb25hbGx5IG5vdy4gKi8KICAgICAgaWYgKHRoaXMuYm91bmRzID09PSBudWxsKSB7CiAgICAgICAgdGhpcy5ib3VuZHMgPSB7CiAgICAgICAgICB4TWluLAogICAgICAgICAgeE1heCwKICAgICAgICAgIHlNaW4sCiAgICAgICAgICB5TWF4CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoeE1pbiA8IHRoaXMuYm91bmRzLnhNaW4pIHsKICAgICAgICAgIHRoaXMuYm91bmRzLnhNaW4gPSB4TWluOwogICAgICAgIH0KICAgICAgICBpZiAoeU1pbiA8IHRoaXMuYm91bmRzLnlNaW4pIHsKICAgICAgICAgIHRoaXMuYm91bmRzLnlNaW4gPSB5TWluOwogICAgICAgIH0KICAgICAgICBpZiAoeE1heCA+IHRoaXMuYm91bmRzLnhNYXgpIHsKICAgICAgICAgIHRoaXMuYm91bmRzLnhNYXggPSB4TWF4OwogICAgICAgIH0KICAgICAgICBpZiAoeU1heCA+IHRoaXMuYm91bmRzLnlNYXgpIHsKICAgICAgICAgIHRoaXMuYm91bmRzLnlNYXggPSB5TWF4OwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmVydGljZXMgPSBudWxsOwogICAgfQogICAgdGhpcy5jdXJYID0geCArIHNoYXBlLmFkdmFuY2UgKiB0aGlzLmZvbnRTaXplOwogICAgdGhpcy5nbHlwaHMucHVzaCh7CiAgICAgIHNoYXBlLAogICAgICB2ZXJ0aWNlcwogICAgfSk7CiAgICB0aGlzLnByZXZDaGFyID0gY2hhcjsKICAgIHRoaXMucHJldkZvbnQgPSBzaGFwZS5mb250OwogIH0KICBHZXRDdXJyZW50UG9zaXRpb24oKSB7CiAgICByZXR1cm4gdGhpcy5jdXJYOwogIH0KCiAgLyoqCiAgICogQHBhcmFtIHN0YXJ0UG9zIHt7eCx5fX0gVEVYVCBncm91cCBmaXJzdCBhbGlnbm1lbnQgcG9pbnQuCiAgICogQHBhcmFtIGVuZFBvcyB7P3t4LHl9fSBURVhUIGdyb3VwIHNlY29uZCBhbGlnbm1lbnQgcG9pbnQuCiAgICogQHBhcmFtIHJvdGF0aW9uIHs/bnVtYmVyfSBSb3RhdGlvbiBhdHRyaWJ1dGUsIGRlZy4KICAgKiBAcGFyYW0gd2lkdGhGYWN0b3Igez9udW1iZXJ9IFJlbGF0aXZlIFggc2NhbGUgZmFjdG9yIChncm91cCA0MSkuCiAgICogQHBhcmFtIGhBbGlnbiB7P251bWJlcn0gSG9yaXpvbnRhbCB0ZXh0IGp1c3RpZmljYXRpb24gdHlwZSBjb2RlIChncm91cCA3MikuCiAgICogQHBhcmFtIHZBbGlnbiB7P251bWJlcn0gVmVydGljYWwgdGV4dCBqdXN0aWZpY2F0aW9uIHR5cGUgY29kZSAoZ3JvdXAgNzMpLgogICAqIEBwYXJhbSBjb2xvciB7bnVtYmVyfQogICAqIEBwYXJhbSBsYXllciB7P3N0cmluZ30KICAgKiBAcmV0dXJuIHtHZW5lcmF0b3I8RW50aXR5Pn0gUmVuZGVyaW5nIGVudGl0aWVzLiBDdXJyZW50bHkganVzdCBpbmRleGVkIHRyaWFuZ2xlcyBmb3IgZWFjaAogICAqICBnbHlwaC4KICAgKi8KICAqUmVuZGVyKHN0YXJ0UG9zLCBlbmRQb3MsIHJvdGF0aW9uLCB3aWR0aEZhY3RvciwgaEFsaWduLCB2QWxpZ24sIGNvbG9yLCBsYXllcikgewogICAgdmFyIF9lbmRQb3MsIF93aWR0aEZhY3RvciwgX2hBbGlnbiwgX3ZBbGlnbjsKICAgIGlmICh0aGlzLmJvdW5kcyA9PT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBlbmRQb3MgPSAoX2VuZFBvcyA9IGVuZFBvcykgIT09IG51bGwgJiYgX2VuZFBvcyAhPT0gdm9pZCAwID8gX2VuZFBvcyA6IHN0YXJ0UG9zOwogICAgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHJvdGF0aW9uICo9IC1NYXRoLlBJIC8gMTgwOwogICAgfSBlbHNlIHsKICAgICAgcm90YXRpb24gPSAwOwogICAgfQogICAgd2lkdGhGYWN0b3IgPSAoX3dpZHRoRmFjdG9yID0gd2lkdGhGYWN0b3IpICE9PSBudWxsICYmIF93aWR0aEZhY3RvciAhPT0gdm9pZCAwID8gX3dpZHRoRmFjdG9yIDogMTsKICAgIGhBbGlnbiA9IChfaEFsaWduID0gaEFsaWduKSAhPT0gbnVsbCAmJiBfaEFsaWduICE9PSB2b2lkIDAgPyBfaEFsaWduIDogSEFsaWduLkxFRlQ7CiAgICB2QWxpZ24gPSAoX3ZBbGlnbiA9IHZBbGlnbikgIT09IG51bGwgJiYgX3ZBbGlnbiAhPT0gdm9pZCAwID8gX3ZBbGlnbiA6IFZBbGlnbi5CQVNFTElORTsKICAgIGxldCBvcmlnaW4gPSBuZXcgVmVjdG9yMigpOwogICAgbGV0IHNjYWxlID0gbmV3IFZlY3RvcjIod2lkdGhGYWN0b3IsIDEpOwogICAgbGV0IGluc2VydGlvblBvcyA9IGhBbGlnbiA9PT0gSEFsaWduLkxFRlQgJiYgdkFsaWduID09PSBWQWxpZ24uQkFTRUxJTkUgfHwgaEFsaWduID09PSBIQWxpZ24uRklUIHx8IGhBbGlnbiA9PT0gSEFsaWduLkFMSUdORUQgPyBuZXcgVmVjdG9yMihzdGFydFBvcy54LCBzdGFydFBvcy55KSA6IG5ldyBWZWN0b3IyKGVuZFBvcy54LCBlbmRQb3MueSk7CiAgICBjb25zdCBHZXRGaXRTY2FsZSA9ICgpID0+IHsKICAgICAgY29uc3Qgd2lkdGggPSBlbmRQb3MueCAtIHN0YXJ0UG9zLng7CiAgICAgIGlmICh3aWR0aCA8IE51bWJlci5NSU5fVkFMVUUgKiAyKSB7CiAgICAgICAgcmV0dXJuIHdpZHRoRmFjdG9yOwogICAgICB9CiAgICAgIHJldHVybiB3aWR0aCAvICh0aGlzLmJvdW5kcy54TWF4IC0gdGhpcy5ib3VuZHMueE1pbik7CiAgICB9OwogICAgY29uc3QgR2V0Rml0Um90YXRpb24gPSAoKSA9PiB7CiAgICAgIHJldHVybiAtTWF0aC5hdGFuMihlbmRQb3MueSAtIHN0YXJ0UG9zLnksIGVuZFBvcy54IC0gc3RhcnRQb3MueCk7CiAgICB9OwogICAgc3dpdGNoIChoQWxpZ24pIHsKICAgICAgY2FzZSBIQWxpZ24uTEVGVDoKICAgICAgICBvcmlnaW4ueCA9IHRoaXMuYm91bmRzLnhNaW47CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgSEFsaWduLkNFTlRFUjoKICAgICAgICBvcmlnaW4ueCA9ICh0aGlzLmJvdW5kcy54TWF4IC0gdGhpcy5ib3VuZHMueE1pbikgLyAyOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEhBbGlnbi5SSUdIVDoKICAgICAgICBvcmlnaW4ueCA9IHRoaXMuYm91bmRzLnhNYXg7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgSEFsaWduLk1JRERMRToKICAgICAgICBvcmlnaW4ueCA9ICh0aGlzLmJvdW5kcy54TWF4IC0gdGhpcy5ib3VuZHMueE1pbikgLyAyOwogICAgICAgIG9yaWdpbi55ID0gKHRoaXMuYm91bmRzLnlNYXggLSB0aGlzLmJvdW5kcy55TWluKSAvIDI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgSEFsaWduLkFMSUdORUQ6CiAgICAgICAgewogICAgICAgICAgY29uc3QgZiA9IEdldEZpdFNjYWxlKCk7CiAgICAgICAgICBzY2FsZS54ID0gZjsKICAgICAgICAgIHNjYWxlLnkgPSBmOwogICAgICAgICAgcm90YXRpb24gPSBHZXRGaXRSb3RhdGlvbigpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIEhBbGlnbi5GSVQ6CiAgICAgICAgc2NhbGUueCA9IEdldEZpdFNjYWxlKCk7CiAgICAgICAgcm90YXRpb24gPSBHZXRGaXRSb3RhdGlvbigpOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnNvbGUud2FybigiVW5yZWNvZ25pemVkIGhBbGlnbiB2YWx1ZTogIiArIGhBbGlnbik7CiAgICB9CiAgICBzd2l0Y2ggKHZBbGlnbikgewogICAgICBjYXNlIFZBbGlnbi5CQVNFTElORToKICAgICAgICBicmVhazsKICAgICAgY2FzZSBWQWxpZ24uQk9UVE9NOgogICAgICAgIG9yaWdpbi55ID0gdGhpcy5ib3VuZHMueU1pbjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBWQWxpZ24uTUlERExFOgogICAgICAgIG9yaWdpbi55ID0gKHRoaXMuYm91bmRzLnlNYXggLSB0aGlzLmJvdW5kcy55TWluKSAvIDI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgVkFsaWduLlRPUDoKICAgICAgICBvcmlnaW4ueSA9IHRoaXMuYm91bmRzLnlNYXg7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc29sZS53YXJuKCJVbnJlY29nbml6ZWQgdkFsaWduIHZhbHVlOiAiICsgdkFsaWduKTsKICAgIH0KICAgIGNvbnN0IHRyYW5zZm9ybSA9IG5ldyBNYXRyaXgzKCkudHJhbnNsYXRlKC1vcmlnaW4ueCwgLW9yaWdpbi55KS5zY2FsZShzY2FsZS54LCBzY2FsZS55KS5yb3RhdGUocm90YXRpb24pLnRyYW5zbGF0ZShpbnNlcnRpb25Qb3MueCwgaW5zZXJ0aW9uUG9zLnkpOwogICAgZm9yIChjb25zdCBnbHlwaCBvZiB0aGlzLmdseXBocykgewogICAgICBpZiAoZ2x5cGgudmVydGljZXMpIHsKICAgICAgICBmb3IgKGNvbnN0IHYgb2YgZ2x5cGgudmVydGljZXMpIHsKICAgICAgICAgIHYuYXBwbHlNYXRyaXgzKHRyYW5zZm9ybSk7CiAgICAgICAgfQogICAgICAgIHlpZWxkIG5ldyBFbnRpdHkoewogICAgICAgICAgdHlwZTogRW50aXR5LlR5cGUuVFJJQU5HTEVTLAogICAgICAgICAgdmVydGljZXM6IGdseXBoLnZlcnRpY2VzLAogICAgICAgICAgaW5kaWNlczogZ2x5cGguc2hhcGUuaW5kaWNlcywKICAgICAgICAgIGxheWVyLAogICAgICAgICAgY29sb3IKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KfQ=="},{"version":3,"names":["Entity","ShapePath","ShapeUtils","Matrix3","Vector2","MTextFormatParser","SPECIAL_CHARS_RE","ParseSpecialChars","text","replaceAll","match","p1","p2","undefined","code","parseInt","isNaN","String","fromCharCode","TextRenderer","constructor","fontFetchers","options","fonts","Object","create","DefaultOptions","assign","shapes","Map","stubShapeLoaded","stubShape","FetchFonts","char","Array","from","fallbackChar","_CreateCharShape","charMissing","codePointAt","found","font","HasChar","length","fetcher","shift","_FetchFont","push","canRender","GetLineWidth","fontSize","block","TextBlock","shape","_GetCharShape","PushChar","GetCurrentPosition","Render","startPos","endPos","rotation","widthFactor","hAlign","vAlign","color","layer","RenderMText","formattedText","position","width","direction","attachment","lineSpacing","box","TextBox","bind","FeedText","get","set","path","GetCharPath","CharShape","fontFetcher","Font","curveSubdivision","glyph","advance","bounds","toShapes","vertices","indices","shapePoints","extractPoints","isClockWise","reverse","hole","holes","h","triangulateShape","_this","baseIdx","AddVertices","v","tuple","idx","GetVertices","size","map","clone","multiplyScalar","add","data","charMap","values","glyphs","unicode","fromCodePoint","scale","unitsPerEm","has","cmd","commands","type","moveTo","x","y","lineTo","quadraticCurveTo","x1","y1","bezierCurveTo","x2","y2","advanceWidth","xMin","xMax","yMin","yMax","GetKerning","c1","c2","i1","charToGlyphIndex","i2","getKerningValue","HAlign","freeze","LEFT","CENTER","RIGHT","ALIGNED","MIDDLE","FIT","VAlign","BASELINE","BOTTOM","TOP","MTextAttachment","TOP_LEFT","TOP_CENTER","TOP_RIGHT","MIDDLE_LEFT","MIDDLE_CENTER","MIDDLE_RIGHT","BOTTOM_LEFT","BOTTOM_CENTER","BOTTOM_RIGHT","charShapeProvider","curParagraph","Paragraph","paragraphs","spaceShape","FlattenItems","items","item","EntityType","SCOPE","content","curAlignment","TEXT","c","FeedSpace","FeedChar","PARAGRAPH","SetAlignment","NON_BREAKING_SPACE","PARAGRAPH_ALIGNMENT","a","alignment","Alignment","JUSTIFY","p","BuildLines","pWidth","GetMaxLineWidth","defaultAlignment","ApplyAlignment","Math","atan2","PI","lineHeight","height","lines","origin","Error","transform","translate","rotate","line","chunkIdx","startChunkIdx","numChunks","chunk","chunks","GetSpacingWidth","applyMatrix3","textBox","curChunk","_AddChunk","lastChar","PushSpace","boxWidth","curChunkIdx","curWidth","CommitLine","Line","chunkWidth","GetWidth","maxWidth","Chunk","paragraph","prevChunk","lastShape","leadingSpaces","spaceStartKerning","spaceEndKerning","withSpacing","_this$paragraph$align","offset","ForEachChunk","space","step","handler","i","curX","prevChar","prevFont","_endPos","_widthFactor","_hAlign","_vAlign","insertionPos","GetFitScale","Number","MIN_VALUE","GetFitRotation","f","console","warn","Type","TRIANGLES"],"sources":["C:/Users/SDC-8/Desktop/Sowndarya/CMTI- Running Projects/PiWeb Running/PiWeb-CMTI-Pdf trying/1stApril/Trying/PiWeb-CMTI (2)/PiWeb-CMTI/node_modules/dxf-viewer/src/TextRenderer.js"],"sourcesContent":["import {Entity} from \"./DxfScene\"\nimport {ShapePath} from \"three/src/extras/core/ShapePath.js\"\nimport {ShapeUtils} from \"three/src/extras/ShapeUtils.js\"\nimport {Matrix3, Vector2} from \"three\"\nimport {MTextFormatParser} from \"./MTextFormatParser\"\n\n/** Regex for parsing special characters in text entities. */\nconst SPECIAL_CHARS_RE = /(?:%%([dpcou%]))|(?:\\\\U\\+([0-9a-fA-F]{4}))/g\n\n/**\n * Parse special characters in text entities and convert them to corresponding unicode\n * characters.\n * https://knowledge.autodesk.com/support/autocad/learn-explore/caas/CloudHelp/cloudhelp/2019/ENU/AutoCAD-Core/files/GUID-518E1A9D-398C-4A8A-AC32-2D85590CDBE1-htm.html\n * @param {string} text Raw string.\n * @return {string} String with special characters replaced.\n */\nexport function ParseSpecialChars(text) {\n    return text.replaceAll(SPECIAL_CHARS_RE, (match, p1, p2) => {\n        if (p1 !== undefined) {\n            switch (p1) {\n            case \"d\":\n                return \"\\xb0\"\n            case \"p\":\n                return \"\\xb1\"\n            case \"c\":\n                return \"\\u2205\"\n            case \"o\":\n                /* Toggles overscore mode on and off, not implemented. */\n                return \"\"\n            case \"u\":\n                /* Toggles underscore mode on and off, not implemented. */\n                return \"\"\n            case \"%\":\n                return \"%\"\n            }\n        } else if (p2 !== undefined) {\n            const code = parseInt(p2, 16)\n            if (isNaN(code)) {\n                return match\n            }\n            return String.fromCharCode(code)\n        }\n        return match\n    })\n}\n\n/**\n * Helper class for rendering text.\n * Currently it is just basic very simplified implementation for MVP. Further work should include:\n *  * Support DXF text styles and weight.\n *  * Bitmap fonts generation in texture atlas for more optimal rendering.\n */\nexport class TextRenderer {\n\n    /**\n     * @param fontFetchers {?Function[]} List of font fetchers. Fetcher should return promise with\n     *  loaded font object (opentype.js). They are invoked only when necessary. Each glyph is being\n     *  searched sequentially in each provided font.\n     * @param options {?{}} See TextRenderer.DefaultOptions.\n     */\n    constructor(fontFetchers, options = null) {\n        this.fontFetchers = fontFetchers\n        this.fonts = []\n\n        this.options = Object.create(TextRenderer.DefaultOptions)\n        if (options) {\n            Object.assign(this.options, options)\n        }\n        /* Indexed by character, value is CharShape. */\n        this.shapes = new Map()\n        this.stubShapeLoaded = false\n        /* Shape to display if no glyph found in the specified fonts. May be null if fallback\n         * character can not be rendered as well.\n         */\n        this.stubShape = null\n    }\n\n    /** Fetch necessary fonts to render the provided text. Should be called for each string which\n     * will be rendered later.\n     * @param text {string}\n     * @return {Boolean} True if all characters can be rendered, false if none of the provided fonts\n     *  contains glyphs for some of the specified text characters.\n     */\n    async FetchFonts(text) {\n        if (!this.stubShapeLoaded) {\n            this.stubShapeLoaded = true\n            for (const char of Array.from(this.options.fallbackChar)) {\n                if (await this.FetchFonts(char)) {\n                    this.stubShape = this._CreateCharShape(char)\n                    break\n                }\n            }\n        }\n        let charMissing = false\n        for (const char of text) {\n            if (char.codePointAt(0) < 0x20) {\n                /* Control character. */\n                continue\n            }\n            let found = false\n            for (const font of this.fonts) {\n                if (font.HasChar(char)) {\n                    found = true\n                    break\n                }\n            }\n            if (found) {\n                continue\n            }\n            if (!this.fontFetchers) {\n                return false\n            }\n            while (this.fontFetchers.length > 0) {\n                const fetcher = this.fontFetchers.shift()\n                const font = await this._FetchFont(fetcher)\n                this.fonts.push(font)\n                if (font.HasChar(char)) {\n                    found = true\n                    break\n                }\n            }\n            if (!found) {\n                charMissing = true\n            }\n        }\n        return !charMissing\n    }\n\n    get canRender() {\n        return this.fonts !== null && this.fonts.length > 0\n    }\n\n    /** Get width in model space units for a single line of text.\n     * @param text {string}\n     * @param fontSize {number}\n     */\n    GetLineWidth(text, fontSize) {\n        const block = new TextBlock(fontSize)\n        for (const char of text) {\n            const shape = this._GetCharShape(char)\n            if (!shape) {\n                continue\n            }\n            block.PushChar(char, shape)\n        }\n        return block.GetCurrentPosition()\n    }\n\n    /**\n     * @param text {string}\n     * @param startPos {{x,y}}\n     * @param endPos {?{x,y}} TEXT group second alignment point.\n     * @param rotation {?number} Rotation attribute, deg.\n     * @param widthFactor {?number} Relative X scale factor (group 41)\n     * @param hAlign {?number} Horizontal text justification type code (group 72)\n     * @param vAlign {?number} Vertical text justification type code (group 73).\n     * @param color {number}\n     * @param layer {?string}\n     * @param fontSize {number}\n     * @return {Generator<Entity>} Rendering entities. Currently just indexed triangles for each\n     *  glyph.\n     */\n    *Render({text, startPos, endPos, rotation = 0, widthFactor = 1, hAlign = 0, vAlign = 0,\n             color, layer = null, fontSize}) {\n        const block = new TextBlock(fontSize)\n        for (const char of text) {\n            const shape = this._GetCharShape(char)\n            if (!shape) {\n                continue\n            }\n            block.PushChar(char, shape)\n        }\n        yield* block.Render(startPos, endPos, rotation, widthFactor, hAlign, vAlign, color, layer)\n    }\n\n    /**\n     * @param {MTextFormatEntity[]} formattedText Parsed formatted text.\n     * @param {{x, y}} position Insertion position.\n     * @param {Number} fontSize\n     * @param {?Number} width Text block width, no wrapping if undefined.\n     * @param {?Number} rotation Text block rotation in degrees.\n     * @param {?{x, y}} direction Text block orientation defined as direction vector. Takes a\n     * precedence over rotation if both provided.\n     * @param {number} attachment Attachment point, one of MTextAttachment values.\n     * @param {?number} lineSpacing Line spacing ratio relative to default one (5/3 of font size).\n     * @param {number} color\n     * @param {?string} layer\n     * @return {Generator<Entity>} Rendering entities. Currently just indexed triangles for each\n     *  glyph.\n     */\n    *RenderMText({formattedText, position, fontSize, width = null, rotation = 0, direction = null,\n                 attachment, lineSpacing = 1, color, layer = null}) {\n        const box = new TextBox(fontSize, this._GetCharShape.bind(this))\n        box.FeedText(formattedText)\n        yield* box.Render(position, width, rotation, direction, attachment, lineSpacing, color,\n                          layer)\n    }\n\n    /** @return {CharShape} Shape for the specified character.\n     * Each shape is indexed triangles mesh for font size 1. They should be further transformed as\n     * needed.\n     */\n    _GetCharShape(char) {\n        let shape = this.shapes.get(char)\n        if (shape) {\n            return shape\n        }\n        shape = this._CreateCharShape(char)\n        this.shapes.set(char, shape)\n        return shape\n    }\n\n    _CreateCharShape(char) {\n        for (const font of this.fonts) {\n            const path = font.GetCharPath(char)\n            if (path) {\n                return new CharShape(font, path, this.options)\n            }\n        }\n        return this.stubShape\n    }\n\n    async _FetchFont(fontFetcher) {\n        return new Font(await fontFetcher())\n    }\n}\n\n\nTextRenderer.DefaultOptions = {\n    /** Number of segments for each curve in a glyph. Currently Three.js does not have more\n     * adequate angle-based or length-based tessellation option.\n     */\n    curveSubdivision: 2,\n    /** Character to use when the specified fonts does not contain necessary glyph. Several ones can\n     * be specified, the first one available is used.\n     */\n    fallbackChar: \"\\uFFFD?\"\n}\n\n/** @typedef {Object} CharPath\n * @property advance {number}\n * @property path {?ShapePath}\n * @property bounds {xMin: number, xMax: number, yMin: number, yMax: number}\n */\n\nclass CharShape {\n    /**\n     * @param font {Font}\n     * @param glyph {CharPath}\n     * @param options {{}} Renderer options.\n     */\n    constructor(font, glyph, options) {\n        this.font = font\n        this.advance = glyph.advance\n        this.bounds = glyph.bounds\n        if (glyph.path) {\n            const shapes = glyph.path.toShapes(false)\n            this.vertices = []\n            this.indices = []\n            for (const shape of shapes) {\n                const shapePoints = shape.extractPoints(options.curveSubdivision)\n                /* Ensure proper vertices winding. */\n                if (!ShapeUtils.isClockWise(shapePoints.shape)) {\n                    shapePoints.shape = shapePoints.shape.reverse()\n                    for (const hole of shapePoints.holes) {\n                        if (ShapeUtils.isClockWise(hole)) {\n                            shapePoints.holes[h] = hole.reverse()\n                        }\n                    }\n                }\n                /* This call also removes duplicated end vertices. */\n                const indices = ShapeUtils.triangulateShape(shapePoints.shape, shapePoints.holes)\n\n                const _this = this\n                const baseIdx = this.vertices.length\n\n                function AddVertices(vertices) {\n                    for (const v of vertices) {\n                        _this.vertices.push(v)\n                    }\n                }\n\n                AddVertices(shapePoints.shape)\n                for (const hole of shapePoints.holes) {\n                    AddVertices(hole)\n                }\n                for (const tuple of indices) {\n                    for (const idx of tuple) {\n                        this.indices.push(baseIdx + idx)\n                    }\n                }\n            }\n\n        } else {\n            this.vertices = null\n        }\n    }\n\n    /** Get vertices array transformed to the specified position and with the specified size.\n     * @param position {{x,y}}\n     * @param size {number}\n     * @return {Vector2[]}\n     */\n    GetVertices(position, size) {\n        return this.vertices.map(v => v.clone().multiplyScalar(size).add(position))\n    }\n}\n\nclass Font {\n    constructor(data) {\n        this.data = data\n        this.charMap = new Map()\n        for (const glyph of Object.values(data.glyphs.glyphs)) {\n            if (glyph.unicode === undefined) {\n                continue\n            }\n            this.charMap.set(String.fromCodePoint(glyph.unicode), glyph)\n        }\n        /* Scale to transform the paths to size 1. */\n        //XXX not really clear what is the resulting unit, check, review and comment it later\n        // (100px?)\n        this.scale = 100 / ((this.data.unitsPerEm || 2048) * 72)\n    }\n\n    /**\n     * @param char {string} Character code point as string.\n     * @return {Boolean} True if the font has glyphs for the specified character.\n     */\n    HasChar(char) {\n        return this.charMap.has(char)\n    }\n\n    /**\n     * @param char {string} Character code point as string.\n     * @return {?CharPath} Path is scaled to size 1. Null if no glyphs for the specified characters.\n     */\n    GetCharPath(char) {\n        const glyph = this.charMap.get(char)\n        if (!glyph) {\n            return null\n        }\n        const scale = this.scale\n        const path = new ShapePath()\n        for (const cmd of glyph.path.commands) {\n            switch (cmd.type) {\n\n            case 'M':\n                path.moveTo(cmd.x * scale, cmd.y * scale)\n                break\n\n            case 'L':\n                path.lineTo(cmd.x * scale, cmd.y * scale)\n                break\n\n            case 'Q':\n                path.quadraticCurveTo(cmd.x1 * scale, cmd.y1 * scale,\n                                      cmd.x * scale, cmd.y * scale)\n                break\n\n            case 'C':\n                path.bezierCurveTo(cmd.x1 * scale, cmd.y1 * scale,\n                                   cmd.x2 * scale, cmd.y2 * scale,\n                                   cmd.x * scale, cmd.y * scale)\n                break\n            }\n        }\n        return {advance: glyph.advanceWidth * scale, path,\n                bounds: {xMin: glyph.xMin * scale, xMax: glyph.xMax * scale,\n                         yMin: glyph.yMin * scale, yMax: glyph.yMax * scale}}\n    }\n\n    /**\n     * @param c1 {string}\n     * @param c2 {string}\n     * @return {number}\n     */\n    GetKerning(c1, c2) {\n        const i1 = this.data.charToGlyphIndex(c1)\n        if (i1 === 0) {\n            return 0\n        }\n        const i2 = this.data.charToGlyphIndex(c1)\n        if (i2 === 0) {\n            return 0\n        }\n        return this.data.getKerningValue(i1, i2) * this.scale\n    }\n}\n\n/** TEXT group attribute 72 values. */\nexport const HAlign = Object.freeze({\n    LEFT: 0,\n    CENTER: 1,\n    RIGHT: 2,\n    ALIGNED: 3,\n    MIDDLE: 4,\n    FIT: 5\n})\n\n/** TEXT group attribute 73 values. */\nexport const VAlign = Object.freeze({\n    BASELINE: 0,\n    BOTTOM: 1,\n    MIDDLE: 2,\n    TOP: 3\n})\n\n/** MTEXT group attribute 71 values. */\nconst MTextAttachment = Object.freeze({\n    TOP_LEFT: 1,\n    TOP_CENTER: 2,\n    TOP_RIGHT: 3,\n    MIDDLE_LEFT: 4,\n    MIDDLE_CENTER: 5,\n    MIDDLE_RIGHT: 6,\n    BOTTOM_LEFT: 7,\n    BOTTOM_CENTER: 8,\n    BOTTOM_RIGHT: 9\n})\n\n/** Encapsulates layout calculations for a multiline-line text block. */\nclass TextBox {\n    /**\n     * @param fontSize\n     * @param {Function<CharShape, String>} charShapeProvider\n     */\n    constructor(fontSize, charShapeProvider) {\n        this.fontSize = fontSize\n        this.charShapeProvider = charShapeProvider\n        this.curParagraph = new TextBox.Paragraph(this)\n        this.paragraphs = [this.curParagraph]\n        this.spaceShape = charShapeProvider(\" \")\n    }\n\n    /** Add some formatted text to the box.\n     * @param {MTextFormatEntity[]} formattedText Parsed formatted text.\n     */\n    FeedText(formattedText) {\n        /* For now advanced formatting is not implemented so scopes are just flattened. */\n        function *FlattenItems(items) {\n            for (const item of items) {\n                if (item.type === MTextFormatParser.EntityType.SCOPE) {\n                    yield *FlattenItems(item.content)\n                } else {\n                    yield item\n                }\n            }\n        }\n\n        /* Null is default alignment which depends on attachment point. */\n        let curAlignment = null\n\n        for (const item of FlattenItems(formattedText)) {\n            switch(item.type) {\n\n            case MTextFormatParser.EntityType.TEXT:\n                for (const c of item.content) {\n                    if (c === \" \") {\n                        this.curParagraph.FeedSpace()\n                    } else {\n                        this.curParagraph.FeedChar(c)\n                    }\n                }\n                break\n\n            case MTextFormatParser.EntityType.PARAGRAPH:\n                this.curParagraph = new TextBox.Paragraph(this)\n                this.curParagraph.SetAlignment(curAlignment)\n                this.paragraphs.push(this.curParagraph)\n                break\n\n            case MTextFormatParser.EntityType.NON_BREAKING_SPACE:\n                this.curParagraph.FeedChar(\" \")\n                break\n\n            case MTextFormatParser.EntityType.PARAGRAPH_ALIGNMENT:\n                let a = null\n                switch (item.alignment) {\n                case \"l\":\n                    a = TextBox.Paragraph.Alignment.LEFT\n                    break\n                case \"c\":\n                    a = TextBox.Paragraph.Alignment.CENTER\n                    break\n                case \"r\":\n                    a = TextBox.Paragraph.Alignment.RIGHT\n                    break\n                case \"d\":\n                    a = TextBox.Paragraph.Alignment.JUSTIFY\n                    break\n                case \"j\":\n                    a = null\n                    break\n                }\n                this.curParagraph.SetAlignment(a)\n                curAlignment = a\n                break\n            }\n        }\n    }\n\n    *Render(position, width, rotation, direction, attachment, lineSpacing, color, layer) {\n        for (const p of this.paragraphs) {\n            p.BuildLines(width)\n        }\n        if (width === null || width === 0) {\n            /* Find maximal paragraph width which will define overall box width. */\n            width = 0\n            for (const p of this.paragraphs) {\n                const pWidth = p.GetMaxLineWidth()\n                if (pWidth > width) {\n                    width = pWidth\n                }\n            }\n        }\n\n        let defaultAlignment = TextBox.Paragraph.Alignment.LEFT\n        switch (attachment) {\n        case MTextAttachment.TOP_CENTER:\n        case MTextAttachment.MIDDLE_CENTER:\n        case MTextAttachment.BOTTOM_CENTER:\n            defaultAlignment = TextBox.Paragraph.Alignment.CENTER\n            break\n        case MTextAttachment.TOP_RIGHT:\n        case MTextAttachment.MIDDLE_RIGHT:\n        case MTextAttachment.BOTTOM_RIGHT:\n            defaultAlignment = TextBox.Paragraph.Alignment.RIGHT\n            break\n        }\n\n        for (const p of this.paragraphs) {\n            p.ApplyAlignment(width, defaultAlignment)\n        }\n\n        /* Box local coordinates have top-left corner origin, so Y values are negative. The\n         * specified attachment should be used to obtain attachment point offset relatively to box\n         * CS origin.\n         */\n\n        if (direction !== null) {\n            /* Direction takes precedence over rotation if specified. */\n            rotation = Math.atan2(direction.y, direction.x) * 180 / Math.PI\n        }\n\n        const lineHeight = lineSpacing * 5 * this.fontSize / 3\n\n        let height = 0\n        for (const p of this.paragraphs) {\n            if (p.lines === null) {\n                /* Paragraph always occupies at least one line. */\n                height++\n            } else {\n                height += p.lines.length\n            }\n        }\n        height *= lineHeight\n\n        let origin = new Vector2()\n        switch (attachment) {\n        case MTextAttachment.TOP_LEFT:\n            break\n        case MTextAttachment.TOP_CENTER:\n            origin.x = width / 2\n            break\n        case MTextAttachment.TOP_RIGHT:\n            origin.x = width\n            break\n        case MTextAttachment.MIDDLE_LEFT:\n            origin.y = -height / 2\n            break\n        case MTextAttachment.MIDDLE_CENTER:\n            origin.x = width / 2\n            origin.y = -height / 2\n            break\n        case MTextAttachment.MIDDLE_RIGHT:\n            origin.x = width\n            origin.y = -height / 2\n            break\n        case MTextAttachment.BOTTOM_LEFT:\n            origin.y = -height\n            break\n        case MTextAttachment.BOTTOM_CENTER:\n            origin.x = width / 2\n            origin.y = -height\n            break\n        case MTextAttachment.BOTTOM_RIGHT:\n            origin.x = width\n            origin.y = -height\n            break\n        default:\n            throw new Error(\"Unhandled alignment\")\n        }\n\n        /* Transform for each chunk insertion point. */\n        const transform = new Matrix3().translate(-origin.x, -origin.y)\n            .rotate(-rotation * Math.PI / 180).translate(position.x, position.y)\n\n        let y = -this.fontSize\n        for (const p of this.paragraphs) {\n            if (p.lines === null) {\n                y -= lineHeight\n                continue\n            }\n            for (const line of p.lines) {\n                for (let chunkIdx = line.startChunkIdx;\n                     chunkIdx < line.startChunkIdx + line.numChunks;\n                     chunkIdx++) {\n\n                    const chunk = p.chunks[chunkIdx]\n                    let x = chunk.position\n                    /* First chunk of continuation line never prepended by whitespace. */\n                    if (chunkIdx === 0 || chunkIdx !== line.startChunkIdx) {\n                        x += chunk.GetSpacingWidth()\n                    }\n                    const v = new Vector2(x, y)\n                    v.applyMatrix3(transform)\n                    if (chunk.block) {\n                        yield* chunk.block.Render(v, null, rotation, null,\n                                                  HAlign.LEFT, VAlign.BASELINE,\n                                                  color, layer)\n                    }\n                }\n                y -= lineHeight\n            }\n        }\n    }\n}\n\nTextBox.Paragraph = class {\n    constructor(textBox) {\n        this.textBox = textBox\n        this.chunks = []\n        this.curChunk = null\n        this.alignment = null\n        this.lines = null\n    }\n\n    /** Feed character for current chunk. Spaces should be fed by FeedSpace() method. If space\n     * character is fed into this method, it is interpreted as non-breaking space.\n     */\n    FeedChar(c) {\n        const shape = this.textBox.charShapeProvider(c)\n        if (shape === null) {\n            return\n        }\n        if (this.curChunk === null) {\n            this._AddChunk()\n        }\n        this.curChunk.PushChar(c, shape)\n    }\n\n    FeedSpace() {\n        if (this.curChunk === null || this.curChunk.lastChar !== null) {\n            this._AddChunk()\n        }\n        this.curChunk.PushSpace()\n    }\n\n    SetAlignment(alignment) {\n        this.alignment = alignment\n    }\n\n    /** Group chunks into lines.\n     *\n     * @param {?number} boxWidth Box width. Do not wrap lines if null (one line is created).\n     */\n    BuildLines(boxWidth) {\n        if (this.curChunk === null) {\n            return\n        }\n        this.lines = []\n        let startChunkIdx = 0\n        let curChunkIdx = 0\n        let curWidth = 0\n\n        const CommitLine = () => {\n            this.lines.push(new TextBox.Paragraph.Line(this,\n                                                       startChunkIdx,\n                                                       curChunkIdx - startChunkIdx,\n                                                       curWidth))\n            startChunkIdx = curChunkIdx\n            curWidth = 0\n        }\n\n        for (; curChunkIdx < this.chunks.length; curChunkIdx++) {\n            const chunk = this.chunks[curChunkIdx]\n            const chunkWidth = chunk.GetWidth(startChunkIdx === 0 || curChunkIdx !== startChunkIdx)\n            if (boxWidth !== null && boxWidth !== 0 && curWidth !== 0 &&\n                curWidth + chunkWidth > boxWidth) {\n\n                CommitLine()\n            }\n            chunk.position = curWidth\n            curWidth += chunkWidth\n        }\n        if (startChunkIdx !== curChunkIdx && curWidth !== 0) {\n            CommitLine()\n        }\n    }\n\n    GetMaxLineWidth() {\n        if (this.lines === null) {\n            return 0\n        }\n        let maxWidth = 0\n        for (const line of this.lines) {\n            if (line.width > maxWidth) {\n                maxWidth = line.width\n            }\n        }\n        return maxWidth\n    }\n\n    ApplyAlignment(boxWidth, defaultAlignment) {\n        if (this.lines) {\n            for (const line of this.lines) {\n                line.ApplyAlignment(boxWidth, defaultAlignment)\n            }\n        }\n    }\n\n    _AddChunk() {\n        this.curChunk = new TextBox.Paragraph.Chunk(this, this.textBox.fontSize, this.curChunk)\n        this.chunks.push(this.curChunk)\n    }\n}\n\nTextBox.Paragraph.Alignment = Object.freeze({\n    LEFT: 0,\n    CENTER: 1,\n    RIGHT: 2,\n    JUSTIFY: 3\n})\n\nTextBox.Paragraph.Chunk = class {\n    /**\n     * @param {TextBox.Paragraph} paragraph\n     * @param {number} fontSize\n     * @param {?TextBox.Paragraph.Chunk} prevChunk\n     */\n    constructor(paragraph, fontSize, prevChunk) {\n        this.paragraph = paragraph\n        this.fontSize = fontSize\n        this.prevChunk = prevChunk\n        this.lastChar = null\n        this.lastShape = null\n        this.leadingSpaces = 0\n        this.spaceStartKerning = null\n        this.spaceEndKerning = null\n        this.block = null\n        this.position = null\n    }\n\n    PushSpace() {\n        if (this.block) {\n            throw new Error(\"Illegal operation\")\n        }\n        this.leadingSpaces++\n    }\n\n    /**\n     * @param char {string}\n     * @param shape {CharShape}\n     */\n    PushChar(char, shape) {\n        if (this.spaceStartKerning === null) {\n            if (this.leadingSpaces === 0) {\n                this.spaceStartKerning = 0\n                this.spaceEndKerning = 0\n            } else {\n                if (this.prevChunk && this.prevChunk.lastShape &&\n                    this.prevChunk.fontSize === this.fontSize &&\n                    this.prevChunk.lastShape.font === this.paragraph.textBox.spaceShape.font) {\n\n                    this.spaceStartKerning =\n                        this.prevChunk.lastShape.font.GetKerning(this.prevChunk.lastChar, \" \")\n                } else {\n                    this.spaceStartKerning = 0\n                }\n                if (shape.font === this.paragraph.textBox.spaceShape.font) {\n                    this.spaceEndKerning = shape.font.GetKerning(\" \", char)\n                } else {\n                    this.spaceEndKerning = 0\n                }\n            }\n        }\n\n        if (this.block === null) {\n            this.block = new TextBlock(this.fontSize)\n        }\n        this.block.PushChar(char, shape)\n\n        this.lastChar = char\n        this.lastShape = shape\n    }\n\n    GetSpacingWidth() {\n        return (this.leadingSpaces * this.paragraph.textBox.spaceShape.advance +\n            this.spaceStartKerning + this.spaceEndKerning) * this.fontSize\n    }\n\n    GetWidth(withSpacing) {\n        if (this.block === null) {\n            return 0\n        }\n        let width = this.block.GetCurrentPosition()\n        if (withSpacing) {\n            width += this.GetSpacingWidth()\n        }\n        return width\n    }\n}\n\nTextBox.Paragraph.Line = class {\n    constructor(paragraph, startChunkIdx, numChunks, width) {\n        this.paragraph = paragraph\n        this.startChunkIdx = startChunkIdx\n        this.numChunks = numChunks\n        this.width = width\n    }\n\n    ApplyAlignment(boxWidth, defaultAlignment) {\n        let alignment = this.paragraph.alignment ?? defaultAlignment\n        switch (alignment) {\n        case TextBox.Paragraph.Alignment.LEFT:\n            break\n        case TextBox.Paragraph.Alignment.CENTER: {\n            const offset = (boxWidth - this.width) / 2\n            this.ForEachChunk(chunk => chunk.position += offset)\n            break\n        }\n        case TextBox.Paragraph.Alignment.RIGHT: {\n            const offset = boxWidth - this.width\n            this.ForEachChunk(chunk => chunk.position += offset)\n            break\n        }\n        case TextBox.Paragraph.Alignment.JUSTIFY: {\n            const space = boxWidth - this.width\n            if (space <= 0 || this.numChunks === 1) {\n                break\n            }\n            const step = space / (this.numChunks - 1)\n            let offset = 0\n            this.ForEachChunk(chunk => {\n                chunk.position += offset\n                offset += step\n            })\n            break\n        }\n        default:\n            throw new Error(\"Unhandled alignment: \" + this.paragraph.alignment)\n        }\n    }\n\n    ForEachChunk(handler) {\n        for (let i = 0; i < this.numChunks; i++) {\n            handler(this.paragraph.chunks[this.startChunkIdx + i])\n        }\n    }\n}\n\n/** Encapsulates calculations for a single-line text block. */\nclass TextBlock {\n    constructor(fontSize) {\n        this.fontSize = fontSize\n        /* Element is {shape: CharShape, vertices: ?{Vector2}[]} */\n        this.glyphs = []\n        this.bounds = null\n        this.curX = 0\n        this.prevChar = null\n        this.prevFont = null\n    }\n\n    /**\n     * @param char {string}\n     * @param shape {CharShape}\n     */\n    PushChar(char, shape) {\n        /* Initially store with just font size and characters position applied. Origin is the first\n         * character base point.\n         */\n        let offset\n        if (this.prevChar !== null && this.prevFont === shape.font) {\n            offset = this.prevFont.GetKerning(this.prevChar, char)\n        } else {\n            offset = 0\n        }\n        const x = this.curX + offset * this.fontSize\n        let vertices\n        if (shape.vertices) {\n            vertices = shape.GetVertices({x, y: 0}, this.fontSize)\n            const xMin = x + shape.bounds.xMin * this.fontSize\n            const xMax = x + shape.bounds.xMax * this.fontSize\n            const yMin = shape.bounds.yMin * this.fontSize\n            const yMax = shape.bounds.yMax * this.fontSize\n            /* Leading/trailing spaces not accounted intentionally now. */\n            if (this.bounds === null) {\n                this.bounds = {xMin, xMax, yMin, yMax}\n            } else {\n                if (xMin < this.bounds.xMin) {\n                    this.bounds.xMin = xMin\n                }\n                if (yMin < this.bounds.yMin) {\n                    this.bounds.yMin = yMin\n                }\n                if (xMax > this.bounds.xMax) {\n                    this.bounds.xMax = xMax\n                }\n                if (yMax > this.bounds.yMax) {\n                    this.bounds.yMax = yMax\n                }\n            }\n        } else {\n            vertices = null\n        }\n        this.curX = x + shape.advance * this.fontSize\n        this.glyphs.push({shape, vertices})\n        this.prevChar = char\n        this.prevFont = shape.font\n    }\n\n    GetCurrentPosition() {\n        return this.curX\n    }\n\n    /**\n     * @param startPos {{x,y}} TEXT group first alignment point.\n     * @param endPos {?{x,y}} TEXT group second alignment point.\n     * @param rotation {?number} Rotation attribute, deg.\n     * @param widthFactor {?number} Relative X scale factor (group 41).\n     * @param hAlign {?number} Horizontal text justification type code (group 72).\n     * @param vAlign {?number} Vertical text justification type code (group 73).\n     * @param color {number}\n     * @param layer {?string}\n     * @return {Generator<Entity>} Rendering entities. Currently just indexed triangles for each\n     *  glyph.\n     */\n    *Render(startPos, endPos, rotation, widthFactor, hAlign, vAlign, color, layer) {\n\n        if (this.bounds === null) {\n            return\n        }\n\n        endPos = endPos ?? startPos\n        if (rotation) {\n            rotation *= -Math.PI / 180\n        } else {\n            rotation = 0\n        }\n        widthFactor = widthFactor ?? 1\n        hAlign = hAlign ?? HAlign.LEFT\n        vAlign = vAlign ?? VAlign.BASELINE\n\n        let origin = new Vector2()\n        let scale = new Vector2(widthFactor, 1)\n        let insertionPos =\n            (hAlign === HAlign.LEFT && vAlign === VAlign.BASELINE) ||\n            hAlign === HAlign.FIT || hAlign === HAlign.ALIGNED ?\n            new Vector2(startPos.x, startPos.y) : new Vector2(endPos.x, endPos.y)\n\n        const GetFitScale = () => {\n            const width = endPos.x - startPos.x\n            if (width < Number.MIN_VALUE * 2) {\n                return widthFactor\n            }\n            return width / (this.bounds.xMax - this.bounds.xMin)\n        }\n\n        const GetFitRotation = () => {\n            return -Math.atan2(endPos.y - startPos.y, endPos.x - startPos.x)\n        }\n\n        switch (hAlign) {\n        case HAlign.LEFT:\n            origin.x = this.bounds.xMin\n            break\n        case HAlign.CENTER:\n            origin.x = (this.bounds.xMax - this.bounds.xMin) / 2\n            break\n        case HAlign.RIGHT:\n            origin.x = this.bounds.xMax\n            break\n        case HAlign.MIDDLE:\n            origin.x = (this.bounds.xMax - this.bounds.xMin) / 2\n            origin.y = (this.bounds.yMax - this.bounds.yMin) / 2\n            break\n        case HAlign.ALIGNED: {\n            const f = GetFitScale()\n            scale.x = f\n            scale.y = f\n            rotation = GetFitRotation()\n            break\n        }\n        case HAlign.FIT:\n            scale.x = GetFitScale()\n            rotation = GetFitRotation()\n            break\n        default:\n            console.warn(\"Unrecognized hAlign value: \" + hAlign)\n        }\n\n        switch (vAlign) {\n        case VAlign.BASELINE:\n            break\n        case VAlign.BOTTOM:\n            origin.y = this.bounds.yMin\n            break\n        case VAlign.MIDDLE:\n            origin.y = (this.bounds.yMax - this.bounds.yMin) / 2\n            break\n        case VAlign.TOP:\n            origin.y = this.bounds.yMax\n            break\n        default:\n            console.warn(\"Unrecognized vAlign value: \" + vAlign)\n        }\n\n        const transform = new Matrix3().translate(-origin.x, -origin.y).scale(scale.x, scale.y)\n            .rotate(rotation).translate(insertionPos.x, insertionPos.y)\n\n        for (const glyph of this.glyphs) {\n            if (glyph.vertices) {\n                for (const v of glyph.vertices) {\n                    v.applyMatrix3(transform)\n                }\n                yield new Entity({\n                   type: Entity.Type.TRIANGLES,\n                   vertices: glyph.vertices,\n                   indices: glyph.shape.indices,\n                   layer, color\n               })\n            }\n        }\n    }\n}\n"],"mappings":"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"}]}